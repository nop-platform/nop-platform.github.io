<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="UTF-8">









  
  
  
    
  


  


  


  






  





  <title>Nop平台核心代码阅读导引 - Nop</title>


  <meta property="og:title" content="Nop平台核心代码阅读导引">


  <meta name="description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">
  <meta property="og:description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">



  
    
  


  <meta name="keywords" content="Nop,Nop平台,Nop 平台,Nop Platform,Nop社区,Nop 社区,Nop Community,可逆计算,软件构造理论,低代码,lowcode,low-code,low code,低代码平台,lcdp,软件工程">


<!-- 页面渲染兼容性 -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- 订阅 -->

<meta name="theme-color" content="#0871ab">
<link rel="shortcut icon" href="/images/nop/logo.png">


    
<link rel="stylesheet" href="/stylesheets/global.css">

    
<link rel="stylesheet" href="/stylesheets/ksio/vendors/share.css">

<link rel="stylesheet" href="/local/syntax-highlighting.css">

<link rel="stylesheet" href="/stylesheets/pages/post.css">

<link rel="stylesheet" href="/stylesheets/pages/doc.css">

    
    
<script src="/javascripts/ksio/vendors/jquery-1.11.3.min.js"></script>

    
<script src="/javascripts/ksio/vendors/bootstrap.min.js"></script>

  </head>
  
  
  <body class="Page" itemscope itemtype="http://schema.org/WebPage">
    

  <header class="Page-header">
  <div class="navbar navbar-static-top">
    <div class="container-fluid">
      <div class="navbar-header">
        
          <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse">
            <span class="sr-only">Toggle navs</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        
        
          


  <a class="navbar-brand" href="/">Nop</a>


        
      </div>
      <!-- Nav menus -->
      <nav class="Page-navs navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          
  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">学习 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy/docs">指南</a>
</li>
  

  
    <li><a href="https://www.zhihu.com/column/reversible-computation?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">文章</a>
</li>
  

  
    <li><a href="https://space.bilibili.com/3493261219990250?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">视频</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">项目 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy">Nop Entropy</a>
</li>
  

  
    <li><a href="/projects/nop-chaos">Nop Chaos</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">关于 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/community">社区</a>
</li>
  

  
    <li><a href="/team">团队</a>
</li>
  

</ul>
    </li>
  


        </ul>
      </nav>
    </div>
  </div>
</header>

<div class="Page-content">
  
  
    <aside class="Page-aside">
      <div class="AsideBrand">


  <a href="/">Nop</a>

</div>
      <nav class="AsideNav"><ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/why-nop/">介绍</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
        
        <a href="/projects/nop-entropy/docs/">文档概览</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/tutorial/">入门教程</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/1-simple-service/">1. 极简服务层开发</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/2-simple-dao/">2. 极简数据访问层开发</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/4-complex-query/">4. 复杂查询</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/5-dynamic-sql/">5. 动态SQL管理</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/compare/">与其他平台的对比</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/">用户指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/installation/">安装和配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/report/">报表引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/idea/idea-plugin/">IDEA插件使用</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/monitor/grafana/">监控</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/">软件架构</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/module-dependency/">模块依赖关系</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a class="is-selected" href="/projects/nop-entropy/docs/core-code-guidance/">核心代码阅读导引</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/theory/">理论基础</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/">开发指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/codegen/">代码生成器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/cli/">命令行工具</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/command/command/">命令行开发支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/config/">配置管理</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/">IoC容器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/aop/">AOP支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/orm/">ORM框架</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/">XLang语言</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdef/">XDef元模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdsl/">XDSL领域语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xscript/">XScript脚本语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xpl/">Xpl模板语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/meta-programming/">元编程</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/model/">Excel模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/graphql/">GraphQL引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/microservice/">分布式微服务</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/rule/rule/">规则引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/workflow/task-flow/">逻辑编排</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/autotest/">自动化测试</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/tenant/">多租户</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/delta/delta-customization/">Delta定制</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/vfs/">Delta文件系统</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/auth/">权限配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/biz/">业务规则</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/nocode/">动态模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xui/">前端模型</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/integration/">第三方集成</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/spring/">spring集成</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/quarkus/">quarkus集成</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/idea/">IDEA插件</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/plugin-dev/">插件开发</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/faq/">常见问题</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/debug-errors/">错误诊断</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/recipe/">常见问题解决方案</a>
      
      
    </li>
  
</ul>

      
    </li>
  
</ul>
</nav>
    </aside>
  
  <main class="Page-main">
    <article class="Article container-fluid">
      <header class="Article-header">
        
  
    <h1 class="Article-title">Nop平台核心代码阅读导引</h1>
  
  


      </header>
      <div class="Article-content col-md-9"><p>Nop平台核心引擎的实现代码都很简短，一般模块的核心代码量都是5000行左右的量级，只有ORM比较复杂一些，1万多行。<br>虽然代码很短，实际实现的功能特性却很多，要把所有细节设计都介绍到，文档量还是不小。建议有问题可以先查看源码，核心特性都有单元测试支持，<br>可以通过调试单元测试来学习源码（直接在关键类中加断点，然后沿着堆栈向上看）。</p>
<p>Nop平台所有的设计都非常简单直接，一般核心代码集中在少数几个类中。</p>
<h2 id="一-可逆计算核心原理"><a href="#一-可逆计算核心原理" class="headerlink" title="一. 可逆计算核心原理"></a>一. 可逆计算核心原理</h2><ol>
<li>ResourceComponentManager<br>平台统一的DSL模型加载入口</li>
<li>DefaultVirtualFileSystem<br>自动扫描classpath下所有<code>_vfs</code>目录中的文件，构成一个虚拟文件系统，并自动识别delta定制路径</li>
<li>ResourceLoadingCache<br>根据虚拟文件路径缓存解析结果</li>
<li>ResourceDependsManager<br>跟踪模型解析过程中发现的模型文件依赖关系，实现方式类似vue组件的动态依赖追踪，当文件被修改时，自动使得所有依赖该文件的解析结果失效</li>
<li>DslModelParser<br>根据XDef元模型配置，使用DslBeanModelParser将XML解析为DSL模型对象</li>
<li>DslNodeLoader和XDslExtender<br>在DslModelParser内部使用，加载资源文件，执行可逆计算理论中的x-extends算法，动态合成XNode节点对象</li>
<li>DeltaMerger和DeltaDiffer<br>实现可逆计算理论中的x-extends算法和x-diff算法</li>
<li>DslModelToXNodeTransformer<br>根据XDef元模型，将DSL模型对象转换为XNode节点</li>
</ol>
<h2 id="二-NopXLang"><a href="#二-NopXLang" class="headerlink" title="二. NopXLang"></a>二. NopXLang</h2><ol>
<li>XLang<br>XLang语言编译器的使用入口</li>
<li>XplCompiler<br>XML格式的Xpl模板语言的编译器</li>
<li>XLangParseTreeParser&#x2F;XLangASTBuildVisitor<br>根据antlr自动生成的XScript脚本语言解析器，并自动将Antlr的ParseTree转换为XLangAST抽象语法树节点</li>
<li>XplLibTagCompiler<br>Xpl模板语言中的标签库编译器</li>
<li>SimpleExprParser<br>简单的嵌入表达式的解析器，不支持函数定义和复杂语句</li>
<li>LexicalScopeAnalysis<br>对抽象语法树进行词法作用域分析，并执行宏函数</li>
<li>BuildExecutableProcessor<br>将抽象语法树节点转换为可执行的IExecutableExpression可执行解释函数接口</li>
<li>XDefinitionParser<br>XDef元模型解析器</li>
<li>DslNodeLoader<br>解析XML文件，执行差量合并，合成得到最终的XNode</li>
<li>XDslValidator<br>根据XDef元模型，验证XNode的合法性</li>
<li>DslModelParser<br>根据XDef元模型，解析XNode得到DSL模型对象</li>
<li>ObjMetaToXDef&#x2F;XDefToObjMeta<br>实现XDefinition元模型和ObjMeta元数据模型之间的相互转换</li>
<li>DslModelToXNodeTransformer<br>将DSL模型对象反向序列化为XNode</li>
<li>DslXNodeToJsonTransformer<br>根据XDef元模型，将DSL对应的XNode节点转换为JSON对象</li>
<li>CompactXNodeToJsonTransformer&#x2F;CompactJsonToXNodeTransformer<br>在没有XDef元模型的情况下，通过约定type和body等少量属性，实现紧凑格式的XNode与JSON之间的相互转换</li>
</ol>
<h2 id="三-NopCodeGen"><a href="#三-NopCodeGen" class="headerlink" title="三. NopCodeGen"></a>三. NopCodeGen</h2><ol>
<li>XCodeGenerator<br>代码生成器的核心入口</li>
<li>CodeGenTask<br>mvn install时通过exec-maven-plugin插件调用的代码生成器入口</li>
<li>CliGenCommand<br>nop-cli命令行工具调用代码生成器的入口函数，内部使用XCodeGenerator实现</li>
<li>AstGrammarBuilder<br>分析g4语法定义，转换为AstGrammar模型结构。根据ParseTree自动构造AST语法树时会使用AstGrammar所提供的信息</li>
<li>JdkJavaCompiler<br>AOP代码生成时使用JDK内置的java编译器来编译Java文件为字节码</li>
<li>JavaObjMetaParser<br>利用janino解析器，将后缀名为xjava的文件解析为ObjMeta对象。EqlAST和XLangAST等生成抽象语法树结构时都使用了这一机制。</li>
</ol>
<h2 id="四-NopIoC"><a href="#四-NopIoC" class="headerlink" title="四. NopIoC"></a>四. NopIoC</h2><ol>
<li>BeanContainerImpl<br>外部访问IoC容器的核心接口，负责管理所有的bean</li>
<li>AppBeanContainerLoader<br>执行bean的自动发现功能。扫描所有模块下的autoconfig bean，以及满足<code>beans/app-*.beans.xml</code>模式的bean文件</li>
<li>BeanContainerBuilder<br>根据收集到的所有bean配置，构建BeanContainer对象</li>
<li>BeanConditionEvaluator<br>检查ioc:condition等动态条件，处理alias映射，剔除所有不满足条件的bean</li>
<li>BeanDefinitionBuilder<br>处理<code>@Inject</code>注解等自动编配属性，初始化所有property的valueResolver</li>
<li>AopBeanProcessor<br>将bean的创建类替换为Aop增强后的派生类，并注入interceptor配置</li>
<li>ConfigExpressionProcessor<br>识别bean属性配置中的<code>@cfg:nop.server.port</code>和<code>$&#123;nop.server.port&#125;</code>这种配置表达式，将它们转换为IValueResolver</li>
</ol>
<h2 id="五-NopConfig"><a href="#五-NopConfig" class="headerlink" title="五. NopConfig"></a>五. NopConfig</h2><ol>
<li>DefaultConfigProvider<br>外部使用配置管理引擎的核心入口</li>
<li>ConfigStarter<br>配置管理引擎的核心逻辑，在这里详细定义了配置项加载顺序和覆盖关系</li>
<li>RouterConfigSource<br>实现灰度配置发布</li>
<li>NacosConfigService<br>基于Nacos实现从远程配置中心获取配置，并实现配置实时更新</li>
</ol>
<h2 id="六-NopDao"><a href="#六-NopDao" class="headerlink" title="六. NopDao"></a>六. NopDao</h2><ol>
<li>DaoProvider<br>外部使用的获取IEntityDao的统一入口</li>
<li>DialectManager<br>统一管理数据库方言模型</li>
<li>JdbcTemplateImpl<br>类似于Spring中的JdbcTemplate，对JDBC访问请求的模板模式封装。内置数据缓存和多数据源支持</li>
<li>JdbcTransactionFactory<br>对数据库事务的封装，支持柔性事务和异步处理</li>
<li>JdbcDataSet<br>通用的DataSet结构封装，凡是表格类型的数据全部封装为统一的IDataSet接口</li>
</ol>
<h2 id="七-NopORM"><a href="#七-NopORM" class="headerlink" title="七. NopORM"></a>七. NopORM</h2><ol>
<li>OrmSessionImpl<br>ORM引擎的核心功能入口，负责所有实体状态切换和一级缓存管理</li>
<li>OrmSessionEntityCache<br>一级缓存的实现。从数据库中获取的所有数据都存放在一级缓存中。</li>
<li>OrmEntity<br>实体对象的基类，记录实体和属性的修改状态</li>
<li>EntityPersisterImpl<br>单实体对象的增删改查处理，识别全局缓存和多租户，内部使用EntityPersisterDriver来最终访问外部存储</li>
<li>CollectionPersisterImpl<br>一对多集合对象的增删改查处理，识别全局缓存和多租户</li>
<li>JdbcEntityPersistDriver<br>单实体对象的JDBC持久化实现</li>
<li>JdbcCollectionPersistDriver<br>一对多集合对象的JDBC持久化实现</li>
<li>OrmBatchLoadQueue<br>批量加载优化，解决JPA长期存在的N+1问题</li>
<li>JdbcQueryExecutor<br>利用EqlCompiler将EQL对象查询语法转换为SQL语句并执行</li>
<li>EqlCompiler<br>将EQL语法编译为SQL语句，使用EqlTransformVisitor将对象属性关联转换为表关联，AstToSqlGenerator根据转换后的AST语法树生成SQL语句</li>
<li>CascadeFlusher<br>session.flush的时候会递归检查所有实体是否被修改，并自动生成对应的增删改查操作，放入BatchActionQueue执行队列，后者最终会调用EntityPersister</li>
<li>OrmTemplate<br>类似于Spring中HibernateTemplate的模板模式封装</li>
<li>EntityDao<br>在OrmTemplate的基础上，针对单个实体类的封装，功能类似于JpaRepository的加强版。一般业务开发中优先使用这个接口</li>
<li>SqlLibManager<br>类似MyBatis的EQL和SQL语句管理器。SqlLibInvoker负责将Mapper接口方法调用转化为对SqlLibManager方法的调用</li>
</ol>
<h2 id="八-NopGraphQL"><a href="#八-NopGraphQL" class="headerlink" title="八. NopGraphQL"></a>八. NopGraphQL</h2><ol>
<li>GraphQLEngine<br>外部使用的GraphQL引擎核心入口</li>
<li>GraphQLDocumentParser<br>手工编写的GraphQL语言解析器</li>
<li>GraphQLSelectionResolver<br>验证前端发过来的GraphQL查询语句中的元素都具有合法定义</li>
<li>RpcSelectionSetBuilder<br>REST调用模式下，如果前端不传送<code>@selection</code>参数，则这里自动添加所有非lazy的字段作为selection</li>
<li>GraphQLExecutor<br>任务派发和结果选择的具体执行逻辑</li>
<li>BizObjectManager<br>使用BizObjectBuilder动态组装BizObject业务对象。将BizObjet上的方法映射为GraphQLOperation，将BizObject的属性结构映射为GraphQLObjectDefinition。</li>
<li>BizObjectBuilder<br>将XMeta文件、XBiz文件中的信息，以及BizModel Java类中的信息合成在一起，构成有一个完整的BizObject业务对象。</li>
<li>ReflectionBizModelBuilder和ReflectionGraphQLTypeFactory<br>使用反射机制，根据Java类上的<code>@BizModel/@BizQuery</code>等注解构造GraphQL操作定义和类型定义</li>
<li>ObjMetaToGraphQLDefinition<br>将xmeta元数据定义转换为GraphQL类型定义</li>
<li>BizModelToGraphQLDefinition<br>将xbiz模型定义转换为GraphQL操作定义</li>
<li>GraphQLActionAuthChecker<br>精确到字段级别的权限约束</li>
</ol>
<h2 id="九-NopRPC"><a href="#九-NopRPC" class="headerlink" title="九. NopRPC"></a>九. NopRPC</h2><ol>
<li>ClusterRpcClient<br>分布式RPC客户端调用的核心逻辑</li>
<li>ClusterRpcProxyFactoryBean&#x2F;RpcInvocationHandler<br>将RPC接口适配到ClusterRpcClient对象上的方法</li>
<li>HttpRpcService<br>基于http协议实现RPC调用</li>
<li>MessageRpcClient<br>基于单向发送和接收的消息队列实现RPC调用</li>
<li>SentinelFlowControlRunner<br>集成Sentinel实现熔断限流</li>
<li>LoadBalanceServerChooser<br>通过负载均衡算法选择服务实例</li>
<li>RouteServiceInstanceFilter<br>识别消息头中的nop-svc-route配置，实现服务的灰度发布</li>
</ol>
<h2 id="十-NopGrpc"><a href="#十-NopGrpc" class="headerlink" title="十. NopGrpc"></a>十. NopGrpc</h2><ol>
<li>GrpcServer<br>启动gRPC服务器，将GraphQL服务转换为gRPC服务对外暴露</li>
<li>GraphQLServerCallHandler<br>将gRPC的服务端处理器转换为对GraphQLEngine的调用</li>
<li>ServiceSchemaManager<br>根据GraphQL类型定义，动态生成protobuf格式的编解码器</li>
<li>GraphQLToApiModel<br>将GraphQL服务定义转换为api.xdef元模型定义的Api模型</li>
</ol>
<h2 id="十一-NopReport"><a href="#十一-NopReport" class="headerlink" title="十一. NopReport"></a>十一. NopReport</h2><ol>
<li>ReportEngine<br>外部访问报表引擎的核心入口</li>
<li>ExcelWorkbookParser<br>将xlsx文件解析为ExcelWorkbook对象，直接解析xlsx文件中的XML，不使用Apache POI包。</li>
<li>ExcelToXptModelTransformer<br>将ExcelWorkbook转换为报表模型对象，</li>
<li>XptModelInitializer<br>分析XptModel中父子单元格的关联关系，产生的分析结果保存在XptCellModel中</li>
<li>ExcelFormulaParser<br>解析Excel公式语法，将它转换为ReportExpr</li>
<li>ReportExpressionParser<br>为普通的表达式引擎增加报表层次坐标语法支持</li>
<li>ExpandedSheetGenerator<br>执行报表引擎的核心逻辑，将ExcelSheet模板动态展开为ExpandedSheet，内部使用TableExpander实现表格展开</li>
<li>TableExpander&#x2F;CellRowExpander&#x2F;CellColExpander<br>执行中国式报表的行列对称展开算法，构造ExpandedTable对象</li>
<li>DynamicReportDataSet<br>在报表展开过程中，提供数据集封装，简化层次坐标和数据集数据转换操作</li>
<li>CellCoordinateHelper<br>层次坐标表达式的核心执行逻辑</li>
<li>ExcelTemplate<br>将展开后的ExpandedSheet导出为Excel文件，直接生成xml和xlsx文件，不使用POI库</li>
<li>HtmlTemplate<br>将展开后的ExpandedSheet导出为Html文件</li>
<li>WordTemplate<br>基于docx格式的Word模板生成Word文件，可以在Word中进行可视化编辑</li>
</ol>
<h2 id="十二-NopRule"><a href="#十二-NopRule" class="headerlink" title="十二. NopRule"></a>十二. NopRule</h2><ol>
<li>RuleManager<br>外部使用规则引擎的核心入口</li>
<li>ExecutableRule和ExecutableMatrixRule<br>决策树和决策矩阵的具体执行逻辑</li>
<li>RuleExprParser<br>手工编写的类似于FEEL（Friendly Enough Expression Language）的表达式语法解析器</li>
<li>DaoRuleModelLoader和DaoRuleModelSaver<br>将规则模型保存到nop_rule_definition表中</li>
<li>RuleExcelModelParser<br>从xlsx文件中解析规则模型，支持决策树和决策矩阵</li>
<li>RuleServiceImpl<br>将规则引擎功能对外暴露为GraphQL和REST服务</li>
</ol>
<h2 id="十三-NopWorkflow"><a href="#十三-NopWorkflow" class="headerlink" title="十三. NopWorkflow"></a>十三. NopWorkflow</h2><ol>
<li>WorkflowManagerImpl<br>外部访问工作流引擎的核心入口</li>
<li>WorkflowImpl<br>从WorkflowManager中创建或者加载的工作流对象，它内部调用WorkflowEngine实现功能</li>
<li>WorkflowEngineImpl<br>工作流引擎的核心实现逻辑</li>
<li>DaoWorkflowStore<br>工作流的持久化存储</li>
<li>WfModelAnalyzer<br>分析工作流模型配置的有效性，并剔除回退分支，构建出DAG有向无环图模型</li>
<li>DaoWfActorResolver<br>适配外部用户、角色、部门管理和工作委托机制</li>
<li>WorkflowServiceImpl<br>提供对外的GraphQL服务和REST服务</li>
</ol>
<h2 id="十四-NopBatch"><a href="#十四-NopBatch" class="headerlink" title="十四. NopBatch"></a>十四. NopBatch</h2><ol>
<li>BatchTaskBuilder<br>负责创建BatchTask的工厂类。它负责组织skip&#x2F;retry&#x2F;transaction&#x2F;process&#x2F;listener的处理顺序</li>
<li>BatchTask<br>批处理任务的核心逻辑，多线程并行执行，每个线程上分批次执行，每次处理一个chunk</li>
<li>RetryBatchConsumer<br>为chunk处理增加失败重试逻辑</li>
<li>BatchProcessorConsumer<br>逐条处理输入数据，并收集所有的输出数据到列表结构中，然后统一调用一次下游的consumer</li>
<li>PartitionDispatchLoader<br>根据业务数据特征，将数据派发到不同的数据分区队列中进行处理</li>
<li>ResourceRecordLoader<br>通用的数据文件加载器</li>
<li>ResourceRecordConsumer<br>通用的数据文件输出机制</li>
<li>BatchGenLoader<br>压力测试中使用的测试数据生成器，根据配置动态生成具有指定数据分布的测试数据</li>
</ol>
<h2 id="十五-NopJob"><a href="#十五-NopJob" class="headerlink" title="十五. NopJob"></a>十五. NopJob</h2><ol>
<li>DefaultJobScheduler<br>外部使用Job调度引擎的核心入口</li>
<li>TriggerBuilder<br>定时触发器的构造逻辑</li>
<li>CalendarBuilder<br>Calendar表达需要被的假期和指定时间区间</li>
<li>TriggerExecutorImpl<br>Job定时调度的核心执行逻辑</li>
</ol>
<h2 id="十六-NopAutoTest"><a href="#十六-NopAutoTest" class="headerlink" title="十六. NopAutoTest"></a>十六. NopAutoTest</h2><ol>
<li>JunitAutoTestCase<br>需要录制回放支持的单元测试从这个基类继承。注解中标注的NopJunitExtension提供了具体的与Junit集成支持</li>
<li>JunitBaseTestCase<br>不需要录制回放功能，但是需要使用NopIoC注入bean的单元测试从这个基类继承</li>
<li>BaseTestCase<br>最简单的，不需要NopIoC自动注入的测试用例可以从这个基类继承，它提供给了获取资源文件数据的一些便捷方法</li>
<li>AutoTestCaseDataBaseInitializer<br>根据input目录下录制的数据自动初始化内存数据库</li>
<li>AutoTestCaseDataSaver<br>将通过AutoTestOrmHook收集到的对数据库修改的内容保存到output目录下</li>
<li>AutoTestCaseResultChecker<br>单元测试执行完之后，自动运行checker来检查执行结果与录制的数据内容是否匹配</li>
<li>AutoTestMatchChecker<br>使用nop-match模块提供的前缀引导匹配语法来校验数据模式</li>
<li>AutoTestVars<br>单元测试运行过程中产生的随机数等每次运行都变化的量需要在这个集合中注册，这样在录制的时候会把它们替换为变量名</li>
</ol>

</div>
      <footer class="Article-footer col-md-3">
        
          
          
          
          
            
          
          
            <div class="Widget">
              <div class="Widget-body"><a href="https://gitee.com/canonical-entropy/nop-entropy/edit/master/docs/core-code-guidance.md" target="_blank" rel=" rel="external nofollow"">在 Gitee 上编辑文档内容</a></div>
            </div>
          
        
        
  

  <section class="Widget Widget--toc">
  <div class="Widget-header">
    <h2 class="Widget-title">目录</h2>
  </div>
  <div class="Widget-body"></div>
</section>



      </footer>
    </article>
    <footer class="Page-footer Footer">
  <div class="container-fluid">
    
    <div class="Footer-description">
      
        <!-- Important links -->
        <nav class="Footer-navs">
          <ul><li><a href="/projects/nop-entropy/docs"><span>指南</span></a>
</li><li><a href="/community"><span>社区</span></a>
</li><li><a href="https://github.com/nop-platform?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>GitHub</span></a>
</li><li><a href="https://gitee.com/nop-platform?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>Gitee</span></a>
</li></ul>
        </nav>
      
      
        <!-- Copyright -->
        <div class="Footer-copyright">
          <p>

&copy; 2024-2025 <a href="https://nop-platform.gitee.io?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow">Nop 社区</a> 版权所有

</p>
          
          
        </div>
      
    </div>
  </div>
</footer>

  </main>
</div>




    <script>$('.Article-content > table').addClass('table table-bordered')</script>
    
<script src="/javascripts/ksio/vendors/share.min.js"></script>

<script src="/javascripts/ksio/components/page.js"></script>

<script src="/javascripts/ksio/components/toc.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.zh-CN.js"></script>

<script src="/javascripts/ksio/initializers/time.js"></script>

<script src="/javascripts/ksio/vendors/jquery.lazyload.js"></script>

<script src="/javascripts/ksio/initializers/lazyload.js"></script>

  </body>
</html>

