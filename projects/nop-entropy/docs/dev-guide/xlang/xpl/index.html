<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="UTF-8">









  
  
  
    
  


  


  


  






  





  <title>XPL - Nop</title>


  <meta property="og:title" content="XPL">


  <meta name="description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">
  <meta property="og:description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">



  
    
  


  <meta name="keywords" content="Nop,Nop平台,Nop 平台,Nop Platform,Nop社区,Nop 社区,Nop Community,可逆计算,软件构造理论,低代码,lowcode,low-code,low code,低代码平台,lcdp,软件工程">


<!-- 页面渲染兼容性 -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- 订阅 -->

<meta name="theme-color" content="#0871ab">
<link rel="shortcut icon" href="/images/nop/logo.png">


    
<link rel="stylesheet" href="/stylesheets/global.css">

    
<link rel="stylesheet" href="/stylesheets/ksio/vendors/share.css">

<link rel="stylesheet" href="/local/syntax-highlighting.css">

<link rel="stylesheet" href="/stylesheets/pages/post.css">

<link rel="stylesheet" href="/stylesheets/pages/doc.css">

    
    
<script src="/javascripts/ksio/vendors/jquery-1.11.3.min.js"></script>

    
<script src="/javascripts/ksio/vendors/bootstrap.min.js"></script>

  </head>
  
  
  <body class="Page" itemscope itemtype="http://schema.org/WebPage">
    

  <header class="Page-header">
  <div class="navbar navbar-static-top">
    <div class="container-fluid">
      <div class="navbar-header">
        
          <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse">
            <span class="sr-only">Toggle navs</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        
        
          


  <a class="navbar-brand" href="/">Nop</a>


        
      </div>
      <!-- Nav menus -->
      <nav class="Page-navs navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          
  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">学习 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy/docs">指南</a>
</li>
  

  
    <li><a href="https://www.zhihu.com/column/reversible-computation?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">文章</a>
</li>
  

  
    <li><a href="https://space.bilibili.com/3493261219990250?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">视频</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">项目 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy">Nop Entropy</a>
</li>
  

  
    <li><a href="/projects/nop-chaos">Nop Chaos</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">关于 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/community">社区</a>
</li>
  

  
    <li><a href="/team">团队</a>
</li>
  

</ul>
    </li>
  


        </ul>
      </nav>
    </div>
  </div>
</header>

<div class="Page-content">
  
  
    <aside class="Page-aside">
      <div class="AsideBrand">


  <a href="/">Nop</a>

</div>
      <nav class="AsideNav"><ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/why-nop/">介绍</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
        
        <a href="/projects/nop-entropy/docs/">文档概览</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/tutorial/">入门教程</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/1-simple-service/">1. 极简服务层开发</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/2-simple-dao/">2. 极简数据访问层开发</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/4-complex-query/">4. 复杂查询</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/5-dynamic-sql/">5. 动态SQL管理</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/compare/">与其他平台的对比</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/">用户指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/installation/">安装和配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/report/">报表引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/idea/idea-plugin/">IDEA插件使用</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/monitor/grafana/">监控</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/">软件架构</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/module-dependency/">模块依赖关系</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/core-code-guidance/">核心代码阅读导引</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/theory/">理论基础</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/">开发指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/codegen/">代码生成器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/cli/">命令行工具</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/command/command/">命令行开发支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/config/">配置管理</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/">IoC容器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/aop/">AOP支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/orm/">ORM框架</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/">XLang语言</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdef/">XDef元模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdsl/">XDSL领域语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xscript/">XScript脚本语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a class="is-selected" href="/projects/nop-entropy/docs/dev-guide/xlang/xpl/">Xpl模板语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/meta-programming/">元编程</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/model/">Excel模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/graphql/">GraphQL引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/microservice/">分布式微服务</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/rule/rule/">规则引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/workflow/task-flow/">逻辑编排</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/autotest/">自动化测试</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/tenant/">多租户</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/delta/delta-customization/">Delta定制</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/vfs/">Delta文件系统</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/auth/">权限配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/biz/">业务规则</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/nocode/">动态模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xui/">前端模型</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/integration/">第三方集成</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/spring/">spring集成</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/quarkus/">quarkus集成</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/idea/">IDEA插件</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/plugin-dev/">插件开发</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/faq/">常见问题</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/debug-errors/">错误诊断</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/recipe/">常见问题解决方案</a>
      
      
    </li>
  
</ul>

      
    </li>
  
</ul>
</nav>
    </aside>
  
  <main class="Page-main">
    <article class="Article container-fluid">
      <header class="Article-header">
        
  
    <h1 class="Article-title">XPL</h1>
  
  


      </header>
      <div class="Article-content col-md-9"><p>XPL是一种采用XML语法格式，支持元编程、支持多种输出模式，与EL表达式（XScript脚本语言）紧密结合的一种模板语言。通过自定义标签，XPL可以引入新的语法结构，<br>实现多种DSL的无缝嵌套。</p>
<h2 id="内置标签"><a href="#内置标签" class="headerlink" title="内置标签"></a>内置标签</h2><p>XPL内置的标签提供了判断、循环、导入、宏处理等基本功能。</p>
<h3 id="控制逻辑"><a href="#控制逻辑" class="headerlink" title="控制逻辑"></a>控制逻辑</h3><ul>
<li><code>&lt;c:if&gt;</code><br>判断语句。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;$&#123;cond&#125;&quot;</span>&gt;</span><br>  当条件为真时执行。<br><span class="hljs-tag">&lt;/<span class="hljs-name">c:if</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;c:for&gt;</code><br>循环语句。<br><code>index</code>对应循环下标, <code>var</code>对应于循环过程中的变量名。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:for</span> <span class="hljs-attr">items</span>=<span class="hljs-string">&quot;$&#123;list&#125;&quot;</span> <span class="hljs-attr">var</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:for</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">c:for</span> <span class="hljs-attr">begin</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">end</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">var</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:for</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;c:while&gt;</code><br>while循环语句。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:while</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;$&#123;cond&#125;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:while</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p><code>&lt;c:break&gt;</code><br>跳出循环语句</p>
</li>
<li><p><code>&lt;c:continue&gt;</code><br>类似于java中的<code>continue</code>语句，跳过本次循环。</p>
</li>
<li><p><code>&lt;c:return&gt;</code><br>从自定义标签返回，可以通过<code>value</code>属性指定返回值.</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:return</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;result&#125;&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;c:choose&gt;</code><br>多重选择语句。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:choose</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;$&#123;cond&#125;&quot;</span>&gt;</span><br>     当条件为true时执行<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">otherwise</span>&gt;</span><br>     当其他条件都不满足时执行<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">otherwise</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:choose</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;c:throw&gt;</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:throw</span> <span class="hljs-attr">errorCode</span>=<span class="hljs-string">&quot;xxx.yyy.zz&quot;</span> <span class="hljs-attr">params</span>=<span class="hljs-string">&quot;$&#123;&#123;a:1,b:2&#125;&#125;&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;c:try&gt;</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:try</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  需要执行的代码<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">catch</span>&gt;</span><br>     捕获异常，上下文中$excetion对应异常对象<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">catch</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">finally</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">finally</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:try</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><ul>
<li><p><code>&lt;c:collect&gt;</code></p>
</li>
<li><p><code>&lt;c:print&gt;</code></p>
</li>
<li><p><code>&lt;c:out&gt;</code></p>
</li>
</ul>
<h3 id="脚本语言"><a href="#脚本语言" class="headerlink" title="脚本语言"></a>脚本语言</h3><ul>
<li><code>&lt;c:script&gt;</code><br>嵌入脚本语言，可以用<code>lang</code>属性来指定使用不同的脚本引擎，例如<code>groovy</code>等，缺省是<code>xlang</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;groovy&quot;</span>&gt;</span><br>  代码<br><span class="hljs-tag">&lt;/<span class="hljs-name">c:script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="编译期"><a href="#编译期" class="headerlink" title="编译期"></a>编译期</h3><ul>
<li><code>&lt;c:import&gt;</code><br>导入常量类或者标签库</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">from</span>=<span class="hljs-string">&quot;a/b.xlib&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;a.b.c.MyConstants&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<p>引入标签库的时候缺省名字空间根据标签库文件名推定，例如 <code>a.xlib =&gt; a</code>, <code>a!ext.xlib =&gt; a</code>。<br>也可以直接指定名字空间，例如</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">from</span>=<span class="hljs-string">&quot;xxx.xlib&quot;</span> <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;yyy&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">yyy:MyTag</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p><code>&lt;c:include&gt;</code></p>
</li>
<li><p><code>&lt;macro:script&gt;</code><br>编译指定内容, 并直接运行</p>
</li>
<li><p><code>&lt;macro:gen&gt;</code><br>宏标签会在编译期被运行。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">macro:gen</span> <span class="hljs-attr">xpl:dump</span>=<span class="hljs-string">&quot;true&quot;</span> &gt;</span><br>  这里的内容先被编译为Expression, 然后在编译期会立刻执行此xpl。<br>  xpl输出的XNode会再次被编译<br><span class="hljs-tag">&lt;/<span class="hljs-name">macro:gen</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><code>&lt;c:unit&gt;</code><br>一个仅起分组作用的虚拟标签。它的直接编译结果为空。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:unit</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span>/&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">input</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:unit</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 等价于 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;c:log&gt;</code><br>只有<code>io.nop.xpl.logger</code>的对应log级别打开时，才拼接日志消息并打印日志。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:log</span> <span class="hljs-attr">info</span>=<span class="hljs-string">&quot;xxx $&#123;myvar&#125; $&#123;myObj.func(3)&#125; sss&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="自定义标签"><a href="#自定义标签" class="headerlink" title="自定义标签"></a>自定义标签</h2><h3 id="条件标签"><a href="#条件标签" class="headerlink" title="条件标签"></a>条件标签</h3><p>当自定义标签的<code>conditionTag</code>设置为<code>true</code>时为条件标签</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 标签定义 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">WhenAdmin</span> <span class="hljs-attr">conditionTag</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">c:script</span>&gt;</span><br>      $userContext.isUserInRole(&#x27;admin&#x27;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">c:script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">WhenAdmin</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 作为条件容器调用 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">biz:WhenAdmin</span>&gt;</span><br>  当用户具有admin角色时执行这里的内容<br><span class="hljs-tag">&lt;/<span class="hljs-name">biz:WhenAdmin</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>条件标签可以直接作为<code>c:choose</code>的分支</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:choose</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">biz:WhenAdmin</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">biz:WhenAdmin</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">c:otherwise</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">c:otherwise</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:choose</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="编译期转换"><a href="#编译期转换" class="headerlink" title="编译期转换"></a>编译期转换</h3><p>自定义标签支持transform配置，可以在编译期对标签节点进行转换。例如<code>bo.xlib</code>中</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Get</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ignoreUnknown&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;selection&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;io.nop.api.core.beans.FieldSelectionBean&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bizObjName&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;thisObj&quot;</span> <span class="hljs-attr">implicit</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;svcCtx&quot;</span> <span class="hljs-attr">implicit</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">transform</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bo-gen:TransformBizObjTag</span> <span class="hljs-attr">xpl:lib</span>=<span class="hljs-string">&quot;bo-gen.xlib&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">transform</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">Get</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>&lt;bo-gen:TransformBizObjTag&gt;</code>标签在编译期执行，它会识别bizObjName属性并自动生成thisObj属性的表达式。例如对于如下标签调用</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bo:Get</span> <span class="hljs-attr">bizObjName</span>=<span class="hljs-string">&quot;NopAuthUser&quot;</span> <span class="hljs-attr">selection</span>=<span class="hljs-string">&quot;items&#123;roleMappings&#125;&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;3&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<p>它经过transform段进行处理之后，将被自动转换为如下标签节点进行编译</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bo:Get</span> <span class="hljs-attr">thisObj</span>=<span class="hljs-string">&quot;$&#123;inject(&#x27;nopBizObjectManager&#x27;).getBizObject(&#x27;NopAuthUser&#x27;)&#125;&quot;</span> <span class="hljs-attr">selection</span>=<span class="hljs-string">&quot;$&#123;selection(&#x27;items&#123;roleMappings&#125;&#x27;)&#125;&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>


<h2 id="动态属性"><a href="#动态属性" class="headerlink" title="动态属性"></a>动态属性</h2><ul>
<li>如果属性值返回<code>null</code>, 则该属性在输出时会被自动忽略。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;$&#123;null&#125;&quot;</span> /&gt;</span><br><br><span class="hljs-comment">&lt;!-- 实际输出 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>xpl:attrs</code>可以指定一个Map, 批量输出一组动态属性。如果属性值为<code>null</code>, 一样不输出</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">xpl:attrs</span>=<span class="hljs-string">&quot;&#123;name:&#x27;a&#x27;,class:null&#125;&quot;</span> /&gt;</span><br><br><span class="hljs-comment">&lt;!-- 实际输出 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<p>另外，需要注意，如果节点上已经存在某属性，则<code>xpl:attrs</code>指定的属性将会被忽略</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;x&quot;</span> <span class="hljs-attr">xpl:attrs</span>=<span class="hljs-string">&quot;&#123;name:&#x27;b&#x27;&#125;&quot;</span> /&gt;</span><br><br><span class="hljs-comment">&lt;!-- 实际输出  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;x&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="输出模式"><a href="#输出模式" class="headerlink" title="输出模式"></a>输出模式</h2><p>xpl标签既有返回值，又有输出。输出具有多种模式</p>
<ul>
<li><code>none</code> 不允许输出文本</li>
<li><code>html</code> 输出html文本，自动识别<code>&lt;script&gt;</code>、<code>&lt;div&gt;</code>等需要使用完整封闭形式的标签</li>
<li><code>xml</code> 输出xml文本，如果<code>xpl:allowUnknownTag</code>为<code>true</code>, 则未识别的所有带名字空间的标签也会被输出</li>
<li><code>text</code> 不能输出xml标签，但是可以输出文本内容，而且输出的文本不会进行xml转义</li>
<li><code>node</code> 所有输出的内容自动被转化为<code>XNode</code>。</li>
</ul>
<ol>
<li>定义标签库时，可以通过在根结点上标记<code>defaultOutputMode</code>来设置本库中标签的缺省输出模式。</li>
<li>也可以在定义每个自定义标签时指定<code>outputMode</code></li>
<li>在调用标签时，可以通过<code>xpl:outputMode</code>来设置未识别的标签的输出模式。如果自定义标签已经有自己的输出模式，则外部调用时再设置也是无效的。</li>
</ol>
<h2 id="thisLib"><a href="#thisLib" class="headerlink" title="thisLib"></a>thisLib</h2><p>在自定义标签库中，可以使用<code>thisLib</code>来指向当前标签库。<br>例如在<code>web.xlib</code>中，  <code>&lt;thisLib:LoadPage&gt;</code>对应于 <code>&lt;web:LoadPage xpl:lib=&quot;/nop/web/xlib/web.xlib&quot;&gt;</code></p>
<p>引入<code>thisLib</code>这个特殊的名字空间的原因在于，外部引用标签库的时候有可能通过<code>as</code>来修改最终使用时的名字空间。例如</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">from</span>=<span class="hljs-string">&quot;/nop/web/xlib/web.xlib&quot;</span> <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;myweb&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">myweb:GenPage</span> <span class="hljs-attr">page</span>=<span class="hljs-string">&quot;xx&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="slot机制"><a href="#slot机制" class="headerlink" title="slot机制"></a>slot机制</h2><p>xpl模板标签的slot机制类似于Vue组件中的slot机制。</p>
<h3 id="1-在标签库中定义标签时声明slot"><a href="#1-在标签库中定义标签时声明slot" class="headerlink" title="1. 在标签库中定义标签时声明slot"></a>1. 在标签库中定义标签时声明slot</h3><figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- /test/my-ext.xlib --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">lib</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">&quot;/nop/schema/xlib.xdef&quot;</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">&quot;/nop/schema/xdsl.xdef&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tags</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">MyTagExt</span> <span class="hljs-attr">outputMode</span>=<span class="hljs-string">&quot;xml&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 声明一个名称为ext的slot --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ext&quot;</span> &gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;x&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">c:unit</span> <span class="hljs-attr">xpl:slot</span>=<span class="hljs-string">&quot;ext&quot;</span> <span class="hljs-attr">xpl:slotArgs</span>=<span class="hljs-string">&quot;&#123;x:3&#125;&quot;</span> /&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">MyTagExt</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tags</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">lib</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>在标签实现中通过<code>xpl:slot</code>属性来引用外部传入的slot实现，通过<code>xpl:slotArgs</code>向slot传递参数。具体能够传递哪些参数需要在slot定义时指定</li>
<li><code>xpl:slot</code>可以标记在任何标签上，并不是只能标记在<code>c:unit</code>标签上。与vue的slot类似，当<code>xpl:slot</code>指定的slot不存在时，会继续执行该标签，否则会用slot替换该标签。<br>也就是说<code>xpl:slot</code>所在的标签相当于是提供了slot的缺省值。</li>
</ul>
<h3 id="2-调用标签时指定slot"><a href="#2-调用标签时指定slot" class="headerlink" title="2. 调用标签时指定slot"></a>2. 调用标签时指定slot</h3><figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">my-ext:MyTagExt</span> <span class="hljs-attr">xpl:lib</span>=<span class="hljs-string">&quot;/test/my-ext.xlib&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">ext</span> <span class="hljs-attr">xpl:slotScope</span>=<span class="hljs-string">&quot;x&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">x</span>&gt;</span>$&#123;x&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">x</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">ext</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">my-ext:MyTagExt</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>调用标签时通过<code>xpl:slotScope</code>来引入<code>xpl:slotArgs</code>传入的参数，此时可以利用javascript的解构语法来给变量重命名。</li>
<li>如果不写<code>xpl:slotScope</code>，实际上仍然可以访问到<code>xpl:slotArgs</code>传入的参数</li>
<li>slot编译为一个函数 slot_{name}, <code>xpl:slotArgs</code>就是向这个函数传递的参数，必须是一个Map。而在标签调用时指定的<code>xpl:slotScope</code>相当于是声明这个函数的参数列表，此时可以重命名参数</li>
</ul>
<p>换句话说：</p>
<ol>
<li>slot是将调用方的body内容，放入实现方的<code>xpl:slot</code>位置</li>
<li>slotArgs 是实现方向调用方传递的参数，在调用方的body中，可以使用这些参数</li>
<li>调用方可以使用<code>xpl:slotScope</code> 来明确引入实现方的参数，同时可以重命名</li>
</ol>
<h3 id="3-指定slotType-node"><a href="#3-指定slotType-node" class="headerlink" title="3. 指定slotType&#x3D;node"></a>3. 指定slotType&#x3D;node</h3><p>缺省情况下slot的类型为renderer，编译为一个函数，这个函数的输出模式可以在slot上指定outputMode来定制。除了编译为函数之外，还可以将指定slotType&#x3D;node，此时<br>slot就保持XNode节点形式直接传入，而不会被转化为函数。此时也不能通过<code>xpl:slot=&quot;slotName&quot;</code>来调用这个slot。</p>
<p>一般使用<code>renderType=node</code>都是将传入的节点作为模型对象或者元数据来使用，特别是结合编译期宏标签机制，可以实现不同的DSL无缝嵌套在一起。</p>
<p>例如biz.xlib中Validator标签</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Validator</span> <span class="hljs-attr">ignoreUnknownAttrs</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">macro</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    runtime标识是运行期存在的变量。这个属性仅当标签是宏标签的时候起作用</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;obj&quot;</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">&quot;$scope&quot;</span> <span class="hljs-attr">runtime</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- slotType=node表示保持XNode节点内容传入到source段中。如果不设置这个属性，则会编译后传入 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;default&quot;</span> <span class="hljs-attr">slotType</span>=<span class="hljs-string">&quot;node&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 在编译期解析标签体得到ValidatorModel, 保存为编译期的变量validatorModel --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">c:script</span>&gt;</span>&lt;![CDATA[<br>           import io.nop.xlang.filter.BizValidatorHelper;<br><br>            let validatorModel = BizValidatorHelper.parseValidator(slot_default);<br>            ...返回编译得到的Expression对象<br>        ]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">c:script</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Validator</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>slot的<code>name=default</code>和<code>slotType=node</code>表示调用时整个标签的body作为XNode类型的节点对象，名称为slot_default</li>
<li>Validator标签的<code>macro=true</code> 表示它是宏标签。它的source段在编译期会运行，输出的结果是一个表达式对象，然后再对该表达式对象进行编译。<br>宏标签相当于是一种内嵌的代码生成器</li>
</ul>
<p>调用时</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">biz:Validator</span> <span class="hljs-attr">xpl:lib</span>=<span class="hljs-string">&quot;/nop/core/xlib/biz.xlib&quot;</span> <span class="hljs-attr">fatalSeverity</span>=<span class="hljs-string">&quot;100&quot;</span></span><br><span class="hljs-tag">               <span class="hljs-attr">obj</span>=<span class="hljs-string">&quot;$&#123;entity&#125;&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">check</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;checkTransferCode&quot;</span> <span class="hljs-attr">errorCode</span>=<span class="hljs-string">&quot;test.not-transfer-code&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">errorDescription</span>=<span class="hljs-string">&quot;扫入的码不是流转码&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">eq</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;flowMode&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">check</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">biz:Validator</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里<code>&lt;biz:Validator&gt;</code>内部嵌套的实际是<code>validator.xdef</code>元模型所定义的验证专用的DSL</p>
<h2 id="xpl专用属性"><a href="#xpl专用属性" class="headerlink" title="xpl专用属性"></a>xpl专用属性</h2><p>XPL内置了一些通用属性，所有标签都可以指定这些属性。xpl属性的处理顺序为<br><code>xpl:enableNs</code> –&gt;  <code>xpl:disableNs</code> –&gt; <code>xpl:attrs</code> -&gt; <code>xpl:frame</code> -&gt; <code>xpl:decorator</code><br>--&gt; <code>xpl:lib</code> –&gt; <code>xpl:outputMode</code> –&gt; <code>xpl:is</code> –&gt; <code>xpl:invert</code> –&gt; <code>xpl:return</code><br>--&gt; <code>xpl:if</code></p>
<ol>
<li><code>xpl:disableNs</code>&#x2F;<code>xpl:enableNs</code><br><code>xpl:disableNs</code> 忽略指定的名字空间，不把它们看作是xpl标签库中的标签<br><code>xpl:enableNs</code> 取消<code>xpl:ignoreNs</code>的作用，恢复识别指定名字空间对应的标签库</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- c:if标签不会被解析，而是作为文本被直接输出 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">c:if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;$&#123;x&#125;&quot;</span> <span class="hljs-attr">xpl:ignoreNs</span>=<span class="hljs-string">&quot;*&quot;</span>&gt;</span><br>   <span class="hljs-comment">&lt;!-- 子节点也不会被解析--&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">my:MyTag</span>&gt;</span><br>       <span class="hljs-comment">&lt;!--  通过xpl:ignoreTag=false恢复对标签的解析 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">c:if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;$&#123;xx&#125;&quot;</span> <span class="hljs-attr">xpl:checkNs</span>=<span class="hljs-string">&quot;*&quot;</span>&gt;</span><br>          ...<br>       <span class="hljs-tag">&lt;/<span class="hljs-name">c:if</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">my:MyTag</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">c:if</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>xpl:ignoreExpr</code><br>是否识别表达式。如果设置为<code>true</code>，则非自定义标签中用到的EL表达式将被作为文本直接输出。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">xpl:ignoreExpr</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>  $&#123;这个表达式不会被解析&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>xpl:is</code><br>可以改变识别的xpl标签名</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">xpl:is</span>=<span class="hljs-string">&quot;my:MyTag&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 等价于 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">my:MyTag</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">my:MyTag</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li><code>xpl:if</code><br>控制标签是否运行，相当于简化<code>c:if</code>调用</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">xpl:if</span>=<span class="hljs-string">&quot;selectors.contains(&#x27;a&#x27;)&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 如果使用编译期表达式，xpl引擎内部会实现自动优化 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">xpl:if</span>=<span class="hljs-string">&quot;#&#123;myVar&#125;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="5">
<li><code>xpl:skipIf</code><br>如果为<code>true</code>, 则跳过本层标签，直接编译标签的<code>body</code>。相当于是控制跳过嵌套的层次</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">my:MyTag</span> <span class="hljs-attr">xpl:skipIf</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">body</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">my:MyTag</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 等价于 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="6">
<li><p><code>xpl:allowUnknownTag</code><br>是否允许未识别的带名字空间的标签。缺省为<code>false</code>, 当带名字空间的标签不能被识别为自定义标签时，会抛出异常。</p>
</li>
<li><p><code>xpl:outputMode</code><br>设置xpl编译器的输出模式。注意，在<code>c:macro</code>和<code>x:extends</code>运行期间，缺省设置了<code>xpl:outputMode=node</code></p>
</li>
<li><p><code>xpl:lib</code><br>在局部范围内引入标签库。当超出标签范围后，引入的标签库不可见。</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">my:MyTag</span> <span class="hljs-attr">xpl:lib</span>=<span class="hljs-string">&quot;my.xlib&quot;</span> /&gt;</span><br><br><span class="hljs-comment">&lt;!-- xpl:lib引入的标签库仅对当前节点有效，对这里的节点不可见，因此编译时会报错 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">my:MyTag</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="9">
<li><code>xpl:return</code><br>执行完标签后将把返回值设置为指定变量</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">my:MyTag</span>  <span class="hljs-attr">xpl:return</span>=<span class="hljs-string">&quot;x&quot;</span>&gt;</span><br>  此标签的执行结果被保存到变量x。相当于 let x = #[my:MyTag()]<br><span class="hljs-tag">&lt;/<span class="hljs-name">my:MyTag</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="10">
<li><code>xpl:invert</code><br>对于返回<code>boolean</code>值的自定义标签，<code>xpl:invert</code>表示对返回值取反。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">biz:WhenAdmin</span>&gt;</span><br>  当具有admin角色的时候执行这里的内容<br><span class="hljs-tag">&lt;/<span class="hljs-name">biz:WhenAdmin</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">biz:WhenAdmin</span> <span class="hljs-attr">xpl:invert</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>   当【不具有】admin角色的时候执行这里的内容<br><span class="hljs-tag">&lt;/<span class="hljs-name">biz:WhenAdmin</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="装饰器decorator"><a href="#装饰器decorator" class="headerlink" title="装饰器decorator"></a>装饰器decorator</h2><p>任何标签都支持名为<code>&lt;xpl:decorator&gt;</code>的装饰子节点, 它可以将嵌套结构变换为线性结构。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">xpl:decorator</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">test:MyTag</span> <span class="hljs-attr">a</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">test:MyTag2</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">xpl:decorated</span>/&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">child</span>/&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">test:MyTag2</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">xpl:decorator</span>&gt;</span><br><br> content<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 等价于 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">test:MyTag</span> <span class="hljs-attr">a</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">test:MyTag2</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">div</span> &gt;</span><br>      content<br>     <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">child</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">test:MyTag2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">test:MyTag</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Xpl模板语言的意义"><a href="#Xpl模板语言的意义" class="headerlink" title="Xpl模板语言的意义"></a>Xpl模板语言的意义</h2><p>xpl模板语言是XLang语言家族中的关键性成员，它的设计超越了现在所有的开源模板语言，特别是为元编程补充了大量语法特性。在XScript脚本语言中可以通过</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> result = xpl <span class="hljs-string">`&lt;c:if&gt;&lt;/c:if&gt;`</span><br></code></pre></td></tr></table></figure>

<p>这种方式嵌入xpl模板语言，而在Xpl模板语言中，也可以用 <code>&lt;c:script&gt;</code>来嵌入脚本语言，并且可以通过各种自定义标签嵌入不同语义和形式的DSL语言。</p>
<p>Xpl模板语言可以设置不同的输出模式，当输出模式为xjson时，可以将xml输出自动转化为json对象，因此我们可以用XML格式来编写AMIS页面</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">crud</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">api</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;xxx&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">crud</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>各种逻辑结构的形式边界在xpl模板语言中可以被很自然的消解，这才是最关键的部分。</p>
<h2 id="代码生成特性"><a href="#代码生成特性" class="headerlink" title="代码生成特性"></a>代码生成特性</h2><p>XLang内置了一些特殊的名字空间，比如x,xpl等，它们会在编译期被处理。如果就是要生成<code>x:abstract</code>这样的属性，可以使用<code>xgen-</code>前缀，例如</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;query&quot;</span> <span class="hljs-attr">xgen-x:abstract</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<p>则实际输出时会移除<code>xgen-</code>前缀，最终生成</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;query&quot;</span> <span class="hljs-attr">x:abstract</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>
</div>
      <footer class="Article-footer col-md-3">
        
          
          
          
          
            
          
          
            <div class="Widget">
              <div class="Widget-body"><a href="https://gitee.com/canonical-entropy/nop-entropy/edit/master/docs/dev-guide/xlang/xpl.md" target="_blank" rel=" rel="external nofollow"">在 Gitee 上编辑文档内容</a></div>
            </div>
          
        
        
  

  <section class="Widget Widget--toc">
  <div class="Widget-header">
    <h2 class="Widget-title">目录</h2>
  </div>
  <div class="Widget-body"></div>
</section>



      </footer>
    </article>
    <footer class="Page-footer Footer">
  <div class="container-fluid">
    
    <div class="Footer-description">
      
        <!-- Important links -->
        <nav class="Footer-navs">
          <ul><li><a href="/projects/nop-entropy/docs"><span>指南</span></a>
</li><li><a href="/community"><span>社区</span></a>
</li><li><a href="https://github.com/nop-platform?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>GitHub</span></a>
</li><li><a href="https://gitee.com/nop-platform?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>Gitee</span></a>
</li></ul>
        </nav>
      
      
        <!-- Copyright -->
        <div class="Footer-copyright">
          <p>

&copy; 2024 <a href="https://nop-platform.gitee.io?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow">Nop 社区</a> 版权所有

</p>
          
          
        </div>
      
    </div>
  </div>
</footer>

  </main>
</div>




    <script>$('.Article-content > table').addClass('table table-bordered')</script>
    
<script src="/javascripts/ksio/vendors/share.min.js"></script>

<script src="/javascripts/ksio/components/page.js"></script>

<script src="/javascripts/ksio/components/toc.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.zh-CN.js"></script>

<script src="/javascripts/ksio/initializers/time.js"></script>

<script src="/javascripts/ksio/vendors/jquery.lazyload.js"></script>

<script src="/javascripts/ksio/initializers/lazyload.js"></script>

  </body>
</html>

