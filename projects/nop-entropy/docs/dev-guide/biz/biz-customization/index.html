<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="UTF-8">









  
  
  
    
  


  


  


  






  





  <title>从可逆计算看后端服务函数的可扩展设计 - Nop</title>


  <meta property="og:title" content="从可逆计算看后端服务函数的可扩展设计">


  <meta name="description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">
  <meta property="og:description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">



  
    
  


  <meta name="keywords" content="Nop,Nop平台,Nop 平台,Nop Platform,Nop社区,Nop 社区,Nop Community,可逆计算,软件构造理论,低代码,lowcode,low-code,low code,低代码平台,lcdp,软件工程">


<!-- 页面渲染兼容性 -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- 订阅 -->

<meta name="theme-color" content="#0871ab">
<link rel="shortcut icon" href="/images/nop/logo.png">


    
<link rel="stylesheet" href="/stylesheets/global.css">

    
<link rel="stylesheet" href="/stylesheets/ksio/vendors/share.css">

<link rel="stylesheet" href="/local/syntax-highlighting.css">

<link rel="stylesheet" href="/stylesheets/pages/post.css">

<link rel="stylesheet" href="/stylesheets/pages/doc.css">

    
    
<script src="/javascripts/ksio/vendors/jquery-1.11.3.min.js"></script>

    
<script src="/javascripts/ksio/vendors/bootstrap.min.js"></script>

  </head>
  
  
  <body class="Page" itemscope itemtype="http://schema.org/WebPage">
    

  <header class="Page-header">
  <div class="navbar navbar-static-top">
    <div class="container-fluid">
      <div class="navbar-header">
        
          <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse">
            <span class="sr-only">Toggle navs</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        
        
          


  <a class="navbar-brand" href="/">Nop</a>


        
      </div>
      <!-- Nav menus -->
      <nav class="Page-navs navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          
  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">学习 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy/docs">指南</a>
</li>
  

  
    <li><a href="https://www.zhihu.com/column/reversible-computation?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">文章</a>
</li>
  

  
    <li><a href="https://space.bilibili.com/3493261219990250?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">视频</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">项目 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy">Nop Entropy</a>
</li>
  

  
    <li><a href="/projects/nop-chaos">Nop Chaos</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">关于 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/community">社区</a>
</li>
  

  
    <li><a href="/team">团队</a>
</li>
  

</ul>
    </li>
  


        </ul>
      </nav>
    </div>
  </div>
</header>

<div class="Page-content">
  
  
    <aside class="Page-aside">
      <div class="AsideBrand">


  <a href="/">Nop</a>

</div>
      <nav class="AsideNav"><ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/why-nop/">介绍</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
        
        <a href="/projects/nop-entropy/docs/">文档概览</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/tutorial/">入门教程</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/1-simple-service/">极简服务层开发</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/2-simple-dao/">极简数据访问层开发</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/compare/">与其他平台的对比</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/">用户指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/installation/">安装和配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/report/">报表引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/idea/idea-plugin/">IDEA插件使用</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/monitor/grafana/">监控</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/">软件架构</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/module-dependency/">模块依赖关系</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/core-code-guidance/">核心代码阅读导引</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/theory/">理论基础</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/">开发指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/codegen/">代码生成器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/cli/">命令行工具</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/command/command/">命令行开发支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/config/">配置管理</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/">IoC容器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/aop/">AOP支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/orm/">ORM框架</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/">XLang语言</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdef/">XDef元模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdsl/">XDSL领域语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xscript/">XScript脚本语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xpl/">Xpl模板语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/meta-programming/">元编程</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/model/">Excel模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/graphql/">GraphQL引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/microservice/">分布式微服务</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/rule/rule/">规则引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/workflow/task-flow/">逻辑编排</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/autotest/">自动化测试</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/tenant/">多租户</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/delta/delta-customization/">Delta定制</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/vfs/">Delta文件系统</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/auth/">权限配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/biz/">业务规则</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/nocode/">动态模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xui/">前端模型</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/integration/">第三方集成</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/spring/">spring集成</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/quarkus/">quarkus集成</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/idea/">IDEA插件</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/plugin-dev/">插件开发</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/faq/">常见问题</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/debug-errors/">错误诊断</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/recipe/">常见问题解决方案</a>
      
      
    </li>
  
</ul>

      
    </li>
  
</ul>
</nav>
    </aside>
  
  <main class="Page-main">
    <article class="Article container-fluid">
      <header class="Article-header">
        
  
    <h1 class="Article-title">从可逆计算看后端服务函数的可扩展设计</h1>
  
  


      </header>
      <div class="Article-content col-md-9"><p>很多低代码平台的核心其实就是一个CRUD模型，一般通过内置的扩展点（比如插入前、插入后等）来提供一定的可定制性。Nop平台中CRUD模型没有任何的特殊性，它内置的CrudBizModel仅仅是一个普通的BizModel模型，在Nop平台核心中并没有任何针对CRUD扩展点的特殊处理。在本文中，我将以CrudBizModel为例，讲解一下Nop平台中实现后台服务时的常见扩展方案。</p>
<h2 id="一-通过回调函数提供定制时机"><a href="#一-通过回调函数提供定制时机" class="headerlink" title="一. 通过回调函数提供定制时机"></a>一. 通过回调函数提供定制时机</h2><p>CrudBizModel中的大部分服务函数都采用了两层抽象，上层函数调用下层的实现函数时通过参数和回调函数来实现定制。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">public <span class="hljs-title class_">PageBean</span>&lt;T&gt; <span class="hljs-title function_">findPage</span>(<span class="hljs-params">@Optional @Name(<span class="hljs-string">&quot;query&quot;</span>) QueryBean query,</span><br><span class="hljs-params">                            FieldSelectionBean selection, </span><br><span class="hljs-params">                            IServiceContext context</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">doFindPage0</span>(query, <span class="hljs-title function_">getBizObjName</span>(), prepareQuery, <br>               selection, context);<br>&#125;<br><br>@<span class="hljs-title class_">BizAction</span><br>public <span class="hljs-title class_">PageBean</span>&lt;T&gt; <span class="hljs-title function_">doFindPage0</span>(<span class="hljs-params">@Name(<span class="hljs-string">&quot;query&quot;</span>) QueryBean query,</span><br><span class="hljs-params">                               @Name(<span class="hljs-string">&quot;authObjName&quot;</span>) <span class="hljs-built_in">String</span> authObjName,</span><br><span class="hljs-params">                               @Name(<span class="hljs-string">&quot;prepareQuery&quot;</span>) BiConsumer&lt;QueryBean, </span><br><span class="hljs-params">                               IServiceContext&gt; prepareQuery, </span><br><span class="hljs-params">                               FieldSelectionBean selection,</span><br><span class="hljs-params">                               IServiceContext context</span>) &#123;<br>     query = <span class="hljs-title function_">prepareFindPageQuery</span>(query, authObjName, <br>                 <span class="hljs-variable constant_">METHOD_FIND_PAGE</span>, prepareQuery, context);                      <br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>findPage函数是通过<code>doFindPage0</code>这个可扩展的函数来实现，<code>doFindPage0</code>提供了两个可配置的参数</p>
<ol>
<li><strong>authObjName</strong> : 缺省情况下它的值对应于当前的业务对象名(bizObjName)，指定不同的值可以在不同业务场景下应用不同的数据权限过滤条件。</li>
<li><strong>prepareQuery</strong>: query参数对应于前端传入的查询条件，后台根据XMeta模型配置校验所有查询字段和查询运算符都在允许范围之内。prepareQuery回调函数可以在前台传入的query条件基础上增加额外的查询条件，而且在这里追加的查询条件不需要进行校验。</li>
</ol>
<p>使用回调函数相当于是提供了一种基于组合的扩展方式，它比基于类继承和函数重载的方式要更加灵活。</p>
<h2 id="二-利用XMeta元数据模型统一动态处理模式"><a href="#二-利用XMeta元数据模型统一动态处理模式" class="headerlink" title="二. 利用XMeta元数据模型统一动态处理模式"></a>二. 利用XMeta元数据模型统一动态处理模式</h2><p>一般的函数复用只是复用一模一样的处理逻辑，最多是通过几个回调函数来提供有限的扩展点，但很多时候并不存在完全一样的处理逻辑，<strong>我们能够抽象只是一种处理模式</strong>。例如，save函数的基本处理逻辑如下：</p>
<ol>
<li>验证前台提交的字段信息</li>
<li>对于支持逻辑删除的实体，需要检查是否存在标记为删除的实体</li>
<li>检查数据库中不存在重复的记录，比如不允许多个用户具有同样的身份证等</li>
<li>根据请求数据创建实体对象，对于复杂的主子表结构需要进行特殊处理</li>
</ol>
<p>每种不同实体的save逻辑的整体结构是完全一致的，但具体的细节不同。比如每个字段的类型和校验规则都不同，部分字段还需要执行转换逻辑，将前台传入的值转换为后台要求的格式等。不同实体上用于区分唯一性的字段也不同。<br>在Nop平台中每个业务对象都可以关联一个XMeta文件，通过它可以定义业务对象的元数据。</p>
<blockquote>
<p>XMeta元数据比Java的注解要更加灵活和强大，它支持元编程和自定义扩展，通过XDef元模型自动进行结构校验。关于XMeta的介绍，参见<a href="../../xlang/xmeta/">xmeta.md</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@Name(&quot;data&quot;)</span> Map&lt;String, Object&gt; data, IServiceContext context)</span> &#123;<br>     <span class="hljs-keyword">return</span> doSave(data, <span class="hljs-literal">null</span>, <span class="hljs-built_in">this</span>::defaultPrepareSave, context);<br>&#125;<br><br> <span class="hljs-meta">@BizAction</span><br> <span class="hljs-keyword">public</span> T <span class="hljs-title function_">doSave</span><span class="hljs-params">(<span class="hljs-meta">@Name(&quot;data&quot;)</span> Map&lt;String, Object&gt; data, </span><br><span class="hljs-params">                 <span class="hljs-meta">@Name(&quot;inputSelection&quot;)</span> FieldSelectionBean inputSelection,</span><br><span class="hljs-params">                 <span class="hljs-meta">@Name(&quot;prepareSave&quot;)</span> BiConsumer&lt;EntityData&lt;T&gt;, </span><br><span class="hljs-params">                 IServiceContext&gt; prepareSave, </span><br><span class="hljs-params">                 IServiceContext context)</span> &#123;<br>     <span class="hljs-keyword">if</span> (CollectionHelper.isEmptyMap(data))<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NopException</span>(ERR_BIZ_EMPTY_DATA_FOR_SAVE)<br>              .param(ARG_BIZ_OBJ_NAME, getBizObjName());<br><br>     <span class="hljs-comment">// 1. 根据XMeta配置实现输入校验和转换</span><br>     <span class="hljs-type">ObjMetaBasedValidator</span> <span class="hljs-variable">validator</span> <span class="hljs-operator">=</span> <br>         <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjMetaBasedValidator</span>(bizObjectManager, bizObj.getBizObjName(),<br>             objMeta,context, <span class="hljs-literal">true</span>);<br><br>     Map&lt;String, Object&gt; validated = <br>           validator.validateForSave(data, inputSelection);<br><br>     <span class="hljs-comment">// 2. 根据ORM实体模型参数判断是否启用逻辑删除</span><br>     <span class="hljs-type">T</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> recoverLogicalDeleted(data, objMeta);<br>     <span class="hljs-type">boolean</span> <span class="hljs-variable">recover</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>     <span class="hljs-keyword">if</span> (entity == <span class="hljs-literal">null</span>) &#123;<br>         recover = <span class="hljs-literal">false</span>;<br>         entity = dao().newEntity();<br>     &#125;<br><br>     <span class="hljs-type">EntityData</span> <span class="hljs-variable">entityData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EntityData</span>&lt;&gt;(data, validated, entity, objMeta); <br><br>     <span class="hljs-comment">// 3. 根据XMeta上配置的唯一键检查重复记录</span><br>     checkUniqueForSave(entityData);<br><br>     <span class="hljs-comment">// 4. 根据XMeta配置确定如何将主子表数据设置到新建的实体对象上</span><br>     <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrmEntityCopier</span>(daoProvider, bizObjectManager)<br>             .copyToEntity(entityData.getValidatedData(),<br>                 entityData.getEntity(), <span class="hljs-literal">null</span>, entityData.getObjMeta(), <br>                 getBizObjName(), BizConstants.METHOD_SAVE, <br>                 context.getEvalScope());<br><br>     <span class="hljs-comment">// 5. 检查实体设置属性后满足数据权限要求，对当前用户可见</span><br>     checkDataAuth(BizConstants.METHOD_SAVE, entityData.getEntity(), context);<br><br>     <span class="hljs-comment">// 6. 执行额外的定制逻辑</span><br>     <span class="hljs-keyword">if</span> (prepareSave != <span class="hljs-literal">null</span>)<br>         prepareSave.accept(entityData, context);<br><br>     doSaveEntity(entityData, context);<br><br>     <span class="hljs-keyword">return</span> entityData.getEntity();<br> &#125;<br></code></pre></td></tr></table></figure>

<p>Nop平台提供了通用的ObjMetaBasedValidator和OrmEntityCopier，它们可以利用XMeta元数据模型中的信息来<strong>统一实现</strong>输入校验以及实体对象构建。</p>
<p>类似的方案频繁用在各种通用处理函数中，例如findTreeEntityPage利用XMeta中的TreeModel配置来生成属性结构的查询语句。</p>
<p>使用XMeta还有一个好处是支持Delta定制。我们在不同的应用中对于同一个业务对象可以使用不同的XMeta模型，从而定制实际处理的内容。如果使用强类型的DTO对象就很难在不修改基础产品源码的情况下实现逻辑定制。</p>
<p><strong>GraphQL的对象组合能力与XMeta的对象结构抽象能力，以及可逆计算的差量化能力结合在一起，可以将大部分CRUD相关的逻辑固化下来。一般不需要编写CRUD相关的代码，也不需要针对不同的场景生成大量代码</strong>，通过统一的实现即可完成主体需求，我们最多只需要向CRUD模型补充偏离标准CRUD处理过程的差量信息即可。</p>
<h2 id="三-通过前缀引导语法在局部扩展领域模型"><a href="#三-通过前缀引导语法在局部扩展领域模型" class="headerlink" title="三. 通过前缀引导语法在局部扩展领域模型"></a>三. 通过前缀引导语法在局部扩展领域模型</h2><p>Nop平台提供的是一种面向语言编程范式(Language Oriented Programming)，也就是说，为了解决当前的业务问题，我们不是直接使用通用语言，而是先建立一个领域特定语言(DSL)，然后用这个语言去表达业务逻辑。</p>
<p>不用把DSL看得特别神秘复杂，它其实只是模型的一种文本展现形式。DSL化的本质是模型化，只要我们对业务问题建立了一个抽象模型，然后为它选择一种文本表达形式，它就自然成为了一种DSL。</p>
<p>在前后端分离和微服务的背景下，前端和后端之间、后端服务之间的所有交互都要通过序列化后的对象数据。如果我们在语义层面上归拢相关的功能，对外只暴露少量粗粒度的服务接口，那么这个服务接口的参数就相当于是某种DSL。</p>
<p><strong>服务函数可以看作是某种执行DSL的虚拟机，传入的参数不同会指导虚拟机执行不同的处理逻辑</strong>。举个具体的例子，CrudBizModel中提供的findPage&#x2F;findList等通用查询函数，它们所接收的查询条件对象QueryBean就可以看作是一种DSL，它描述了针对一个复杂对象结构的组合查询条件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">POST /r/NopAuthDept__findPage<br><br>&#123;<br>   &quot;query&quot;: &#123;<br>      &quot;filter&quot;: &#123;<br>          &quot;$type&quot;: &quot;or&quot;,<br>          &quot;$body&quot;: [<br>             &#123;<br>                &quot;$type&quot;: &quot;eq&quot;,<br>                &quot;name&quot;: &quot;status&quot;,<br>                &quot;value&quot;: 1<br>             &#125;,<br>             &#123;<br>                &quot;$type&quot;: &quot;gt&quot;,<br>                &quot;name&quot;: &quot;parent.status&quot;,<br>                &quot;value&quot;: 2<br>             &#125;<br>          ]<br>      &#125;,<br>      &quot;orderBy&quot;:[<br>         &#123;<br>           &quot;name&quot;: &quot;status&quot;,<br>           &quot;desc&quot; : false<br>         &#125;<br>      ]<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>query对象在后台对应于QueryBean结构，它是一个通用的查询模型，可以在XML格式和JSON格式之间自由转换。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">query</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">or</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">eq</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">gt</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;parent.status&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> /&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">or</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">orderBy</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">desc</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">orderBy</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>通过QueryBean查询模型，我们可以表达包含嵌套and&#x2F;or关系的复杂查询条件，而且借助于NopORM引擎的关联查询能力，我们可以通过<code>parent.status</code>这种复合属性语法来自动实现主子表关联查询。</p>
<blockquote>
<p>一般情况下通过一个统一的findPage函数就足以完成各种业务查询，不需要单独编写大量的查询函数。可以通过XMeta模型来控制哪些字段能够支持哪些查询运算符，最多一次能查询几个字段等，防止前端构造复杂查询形成拒绝服务攻击。</p>
</blockquote>
<p><strong>每个模型都是可以看作是一个DSL，而同一个DSL在不同的应用场景下可以用不同的解释器去解释运行</strong>。仍然是以QueryBean模型为例，我们可以将它转换为SQL语句送到数据库中执行，也可以将它编译为内存中运行的Predicate函数。规则引擎可以使用QueryBean模型来表达复杂判断条件，而前台的业务规则设计器可以根据DSL的内容自动生成可视化展现和编辑工具等。</p>
<p><img src="/knosys/project-nop-entropy/dev-guide/rule/images/rule-model.png"></p>
<p>Nop平台内置了大量DSL，并且提供了各种表象变换手段（比如每个DSL都自动具有Excel表象，无需编程可以通过Excel来），支持DSL之间的无缝嵌入。这使得我们在做一般的业务开发的时候并不需要创建新的DSL。<br>但是这并不意味着我们只能使用Nop平台内置的模型语义。Nop平台中所有的模型在实际执行之前都会经过多次模型变换，在这个过程中我们可以引入自己的DSL语法翻译规则，从而为已有的DSL模型增加新的扩展语义。</p>
<p>一个在Nop平台中常用的技巧是使用前缀引导语法。具体来说就是引入一个特别的前缀，比如<code>@filter:</code>，通过它<strong>将一个值增强为一个可以被解释器增强的领域结构</strong>。</p>
<blockquote>
<p>关于前缀引导语法的详细介绍，参见我的文章 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/548314138">DSL分层语法设计及前缀引导语法</a></p>
</blockquote>
<p>这种做法的好处是可以基本保证原有DSL模型的整体形式不变，仅在局部进行扩展，从而可以和其他的语法结构组合在一起。</p>
<p>比如有人提出一个特殊的查询需求，希望能够以简洁的方式过滤掉已经被选中的记录。这一需求可以使用前缀引导语法表示为</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">notIn</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;@filter:selectedItemIds&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>

<p>CrudBizModel中所有的查询条件都会应用全局的IQueryTransformer转换器。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IQueryTransformer</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(QueryBean filter, String authObjName, String action,</span><br><span class="hljs-params">                   IBizObject bizObj, IServiceContext context)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>结合上一节中XMeta的能力，我们可以通过bizObj获取到XMeta中的扩展配置信息，从而决定<code>@filter:</code>前缀后面的表达式如何解释。一种可行的做法是直接将它映射为某个Xpl模板标签，然后生成子查询语句或者动态获取到对应的数据集合。</p>
<h2 id="四-通过XBiz模型增加服务函数"><a href="#四-通过XBiz模型增加服务函数" class="headerlink" title="四. 通过XBiz模型增加服务函数"></a>四. 通过XBiz模型增加服务函数</h2><p>Nop平台在逻辑的全局组织结构层面广泛采用类似Docker镜像切片的分层叠加结构。对于后台服务而言，Nop平台的做法是将业务对象BizObject分解为具有不同优先级的多个切片。</p>
<p><img src="/knosys/project-nop-entropy/dev-guide/biz/gather-and-scatter.png"></p>
<p>举例来说，Java编写的CrudBizModel可以看作是一个基础的行为切片，它采用ProCode模式开发。每个业务对象都有一个配对的XBiz模型文件（XML格式），它相当于是一种扩展BizModel的DSL语言，<br>在其中我们可以使用XML语法来定义业务方法。XBiz模型相当于是一种优先级更高的行为切片，它覆盖在底层的CrudBizModel之上。如果在XBiz模型中定义了同名的服务方法，则会直接覆盖Java中的实现。如果没有重名，则会为业务对象新增业务方法。在更上层，可以是无代码编程模式下引入的动态行为切片，它可以保存在数据库的某个动态模型定义表中，在启动的时候自动加载发布为虚拟文件系统中的一个模型文件，然后利用虚拟文件系统的Delta定制机制覆盖原有的XBiz文件。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">biz</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">&quot;/nop/schema/biz/xbiz.xdef&quot;</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">&quot;/nop/schema/xdsl.xdef&quot;</span></span><br><span class="hljs-tag">     <span class="hljs-attr">x:extends</span>=<span class="hljs-string">&quot;_NopAuthUser.xbiz&quot;</span> <span class="hljs-attr">xmlns:bo</span>=<span class="hljs-string">&quot;bo&quot;</span> <span class="hljs-attr">xmlns:c</span>=<span class="hljs-string">&quot;c&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">actions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">query</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;active_findPage&quot;</span> <span class="hljs-attr">x:prototype</span>=<span class="hljs-string">&quot;findPage&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;io.nop.auth.api.AuthApiConstants&quot;</span> /&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">bo:DoFindPage</span> <span class="hljs-attr">query</span>=<span class="hljs-string">&quot;$&#123;query&#125;&quot;</span> <span class="hljs-attr">selection</span>=<span class="hljs-string">&quot;$&#123;selection&#125;&quot;</span> <span class="hljs-attr">xpl:lib</span>=<span class="hljs-string">&quot;/nop/biz/xlib/bo.xlib&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">eq</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;AuthApiConstants.USER_STATUS_ACTIVE&#125;&quot;</span> /&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">bo:DoFindPage</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">query</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">actions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">biz</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>XBiz模型可以通过通用的<code>x:extends</code>语法来继承已有的模型文件或者代码生成器自动生成的模型文件。</li>
<li>在<code>&lt;source&gt;</code>段中我们可以使用Xpl模板语言中的自定义标签来实现自定义封装。<strong>Xpl模板语言提供了隐式参数和编译期变换等机制，可以实现比一般程序语言更简洁的领域特定表达</strong>。</li>
</ul>
<p>例如<code>bo.xlib</code>标签中提供了对于CrudBizModel中<code>doFindPage/doFindList</code>等函数的封装。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bo:DoFindPage</span> <span class="hljs-attr">bizObjName</span>=<span class="hljs-string">&quot;NopAuthUser&quot;</span> <span class="hljs-attr">xpl:lib</span>=<span class="hljs-string">&quot;/nop/biz/xlib/bo.xlib&quot;</span> <span class="hljs-attr">selection</span>=<span class="hljs-string">&quot;items&#123;name,status&#125;&quot;</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">c:if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;$&#123;xxx&#125;&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">eq</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">c:if</span>&gt;</span>  <br><br>          <span class="hljs-comment">&lt;!--可以使用更简洁的表达方式 --&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">eq</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> <span class="hljs-attr">xpl:if</span>=<span class="hljs-string">&quot;xxx&quot;</span> /&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bo:DoFindPage</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;bo:DoFindPage&gt;</code>标签如果指定了<code>bizObjName</code>参数就会调用指定业务对象上的方法，否则会调用当前上下文中的<code>thisObj</code>对象上的方法。</li>
<li>如果指定了selection参数，则会在获取到实体对象之后自动调用<code>dao.batchLoadSelection(entityList,selection)</code>函数，批量加载所有指定的属性，避免后续访问时逐个触发延迟加载影响性能。</li>
<li><code>&lt;bo:DoFindPage&gt;</code>标签的filter子节点本质上是提供了第一节中提到的<code>doFindPage</code>函数的<code>prepareQuery</code>回调函数，这里可以使用Xpl模板语言来动态生成查询条件。</li>
</ul>
<p>这个标签中的bizObjName属性和selection属性的具体实现方式很有意思，它们都是利用了Xpl自定义标签的编译期转换机制来实现。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">DoFindPage</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;query&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;io.nop.api.core.beans.query.QueryBean&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;authObjName&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;String&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;selection&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;io.nop.api.core.beans.FieldSelectionBean&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bizObjName&quot;</span> <span class="hljs-attr">optional</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;thisObj&quot;</span> <span class="hljs-attr">implicit</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;io.nop.biz.api.IBizObject&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;svcCtx&quot;</span> <span class="hljs-attr">implicit</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;io.nop.core.context.IServiceContext&quot;</span>/&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">transform</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">c:script</span>&gt;</span>&lt;![CDATA[<br>            const bizObjName = node.attrText(&#x27;bizObjName&#x27;);<br>            if(bizObjName != null)&#123;<br>               $.checkArgument(bizObjName.$isValidSimpleVarName(),&quot;bizObjName&quot;);<br>               node.setAttr(node.attrLoc(&#x27;bizObjName&#x27;),&#x27;thisObj&#x27;, &quot;$&#123;inject(&#x27;nopBizObjectManager&#x27;).getBizObject(&#x27;&quot; +bizObjName+&quot;&#x27;)&#125;&quot;);<br>            &#125;<br>            const selection = node.attrText(&#x27;selection&#x27;);<br>            if(selection and !selection.contains(&#x27;$&#123;&#x27;))&#123;<br>                node.setAttr(node.attrLoc(&#x27;selection&#x27;),&#x27;selection&#x27;, &quot;$&#123;selection(&#x27;&quot;+selection+&quot;&#x27;)&#125;&quot;);<br>            &#125;<br>        ]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">c:script</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">transform</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span><br>      ...<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">DoFindPage</span>&gt;</span>        <br></code></pre></td></tr></table></figure>

<p>在编译期发现了bizObjName或者selection参数非空，会自动将它们转换为表达式</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bo:DoFindPage</span> <span class="hljs-attr">thisObj</span>=<span class="hljs-string">&quot;$&#123;inject(&#x27;nopBizObjectManager&#x27;).getBizObject(&#x27;NopAuthUser&#x27;)&#125;&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">selection</span>=<span class="hljs-string">&quot;$&#123;selection(&#x27;items&#123;name,status&#125;&#x27;)&#125;&quot;</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">bo:DoFindPage</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>selection函数是一个全局宏函数，它会在编译期解析自己的参数将它转换为一个<code>FieldSelectionBean</code>对象。在运行期直接使用解析好的结果，不用重复解析。</p>
</li>
<li><p>如果和使用Java语言去实现同样功能做比较，可以明显发现Xpl标签在调用的时候更加简洁，可以避免重复表达那些可以自动推导出来的信息。</p>
</li>
<li><p>可以想象一下如果要表达 “指定了bizObjName参数就调用指定对象，否则就调用thisObj当前对象”这一逻辑如何表达？当我们不需要使用thisObj的时候能否在DSL描述中完全屏蔽这一概念。</p>
</li>
</ul>
<h2 id="五-通过元编程增强XBiz模型"><a href="#五-通过元编程增强XBiz模型" class="headerlink" title="五. 通过元编程增强XBiz模型"></a>五. 通过元编程增强XBiz模型</h2><p>一旦引入XBiz这样的DSL模型文件，就可以立刻施展标准化的元编程套路，为DSL模型引入更多的自定义扩展。例如，在XBiz文件中，我们可以通过如下方式引入逻辑编排支持。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">biz</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">x:post-extends</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">biz-gen:TaskFlowSupport</span> <span class="hljs-attr">xpl:lib</span>=<span class="hljs-string">&quot;/nop/core/xlib/biz-gen.xlib&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">x:post-extends</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">actions</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mutation</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;callTask&quot;</span> <span class="hljs-attr">task:name</span>=<span class="hljs-string">&quot;test/DemoTask&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">actions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">biz</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p><code>x:post-extends</code>在模型解析的编译期自动执行，通过<code>&lt;biz-gen:TaskFlowSupport&gt;</code>标签会自动对具有<code>task:name</code>的函数节点进行变换，自动生成调用TaskFlowManager的代码。</p>
</li>
<li><p>我们可以使用可视化的逻辑编排设计器来设计<code>Task</code>，然后在XBiz模型中只要为服务函数指定它所关联的<code>task:name</code>即可。</p>
</li>
</ul>
<p>详细的介绍参见 </p>
<ul>
<li><p><a href="../../workflow/task-flow-for-biz/">通过NopTaskFlow逻辑编排实现后台服务函数</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/612512300">XDSL：通用的领域特定语言设计</a></p>
</li>
</ul>

</div>
      <footer class="Article-footer col-md-3">
        
          
          
          
          
            
          
          
            <div class="Widget">
              <div class="Widget-body"><a href="https://gitee.com/canonical-entropy/nop-entropy/edit/master/docs/dev-guide/biz/biz-customization.md" target="_blank" rel=" rel="external nofollow"">在 Gitee 上编辑文档内容</a></div>
            </div>
          
        
        
  

  <section class="Widget Widget--toc">
  <div class="Widget-header">
    <h2 class="Widget-title">目录</h2>
  </div>
  <div class="Widget-body"></div>
</section>



      </footer>
    </article>
    <footer class="Page-footer Footer">
  <div class="container-fluid">
    
    <div class="Footer-description">
      
        <!-- Important links -->
        <nav class="Footer-navs">
          <ul><li><a href="/projects/nop-entropy/docs"><span>指南</span></a>
</li><li><a href="/community"><span>社区</span></a>
</li><li><a href="https://github.com/nop-platform?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>GitHub</span></a>
</li><li><a href="https://gitee.com/nop-platform?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>Gitee</span></a>
</li></ul>
        </nav>
      
      
        <!-- Copyright -->
        <div class="Footer-copyright">
          <p>

&copy; 2024 <a href="https://nop-platform.gitee.io?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow">Nop 社区</a> 版权所有

</p>
          
          
        </div>
      
    </div>
  </div>
</footer>

  </main>
</div>




    <script>$('.Article-content > table').addClass('table table-bordered')</script>
    
<script src="/javascripts/ksio/vendors/share.min.js"></script>

<script src="/javascripts/ksio/components/page.js"></script>

<script src="/javascripts/ksio/components/toc.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.zh-CN.js"></script>

<script src="/javascripts/ksio/initializers/time.js"></script>

<script src="/javascripts/ksio/vendors/jquery.lazyload.js"></script>

<script src="/javascripts/ksio/initializers/lazyload.js"></script>

  </body>
</html>

