<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="UTF-8">









  
  
  
    
  


  


  


  






  





  <title>运行时监控 - Nop</title>


  <meta property="og:title" content="运行时监控">


  <meta name="description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">
  <meta property="og:description" content="Nop Platform 2.0 是基于可逆计算原理从零开始构建的新一代低代码平台，它致力于克服低代码平台无法摆脱穷举法的困境，从理论层面超越组件技术，有效的解决粗粒度软件复用的问题。">



  
    
  


  <meta name="keywords" content="Nop,Nop平台,Nop 平台,Nop Platform,Nop社区,Nop 社区,Nop Community,可逆计算,软件构造理论,低代码,lowcode,low-code,low code,低代码平台,lcdp,软件工程">


<!-- 页面渲染兼容性 -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- 订阅 -->

<meta name="theme-color" content="#0871ab">
<link rel="shortcut icon" href="/images/nop/logo.png">


    
<link rel="stylesheet" href="/stylesheets/global.css">

    
<link rel="stylesheet" href="/stylesheets/ksio/vendors/share.css">

<link rel="stylesheet" href="/local/syntax-highlighting.css">

<link rel="stylesheet" href="/stylesheets/pages/post.css">

<link rel="stylesheet" href="/stylesheets/pages/doc.css">

    
    
<script src="/javascripts/ksio/vendors/jquery-1.11.3.min.js"></script>

    
<script src="/javascripts/ksio/vendors/bootstrap.min.js"></script>

  </head>
  
  
  <body class="Page" itemscope itemtype="http://schema.org/WebPage">
    

  <header class="Page-header">
  <div class="navbar navbar-static-top">
    <div class="container-fluid">
      <div class="navbar-header">
        
          <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse">
            <span class="sr-only">Toggle navs</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        
        
          


  <a class="navbar-brand" href="/">Nop</a>


        
      </div>
      <!-- Nav menus -->
      <nav class="Page-navs navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          
  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">学习 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy/docs">指南</a>
</li>
  

  
    <li><a href="https://www.zhihu.com/column/reversible-computation?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">文章</a>
</li>
  

  
    <li><a href="https://space.bilibili.com/3493261219990250?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">视频</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">项目 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/projects/nop-entropy">Nop Entropy</a>
</li>
  

  
    <li><a href="/projects/nop-chaos">Nop Chaos</a>
</li>
  

</ul>
    </li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">关于 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="/community">社区</a>
</li>
  

  
    <li><a href="/team">团队</a>
</li>
  

  
    <li><a href="https://gitee.com/nop-platform?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">Gitee 组织</a>
</li>
  

</ul>
    </li>
  

  
    <li><a href="https://nop-platform.github.io?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-header" target="_blank" rel="external nofollow">English</a>
</li>
  


        </ul>
      </nav>
    </div>
  </div>
</header>

<div class="Page-content">
  
  
    <aside class="Page-aside">
      <div class="AsideBrand">


  <a href="/">Nop</a>

</div>
      <nav class="AsideNav"><ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/why-nop/">介绍</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
        
        <a href="/projects/nop-entropy/docs/">文档概览</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/tutorial/">入门教程</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/1-simple-service/">极简服务层开发</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/tutorial/simple/2-simple-dao/">极简数据访问层开发</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/compare/">与其他平台的对比</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/">用户指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/installation/">安装和配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/report/">报表引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/user-guide/idea/idea-plugin/">IDEA插件使用</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a class="is-selected" href="/projects/nop-entropy/docs/user-guide/monitor/grafana/">监控</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/">软件架构</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/arch/module-dependency/">模块依赖关系</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/core-code-guidance/">核心代码阅读导引</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/theory/">理论基础</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/">开发指南</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/codegen/">代码生成器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/cli/">命令行工具</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/command/command/">命令行开发支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/config/">配置管理</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/">IoC容器</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ioc/aop/">AOP支持</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/orm/">ORM框架</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/">XLang语言</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdef/">XDef元模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdsl/">XDSL领域语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xscript/">XScript脚本语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/xpl/">Xpl模板语言</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xlang/meta-programming/">元编程</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/model/">Excel模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/graphql/">GraphQL引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/microservice/">分布式微服务</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/rule/rule/">规则引擎</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/workflow/task-flow/">逻辑编排</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/autotest/">自动化测试</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/tenant/">多租户</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/delta/delta-customization/">Delta定制</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/vfs/">Delta文件系统</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/auth/">权限配置</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/biz/">业务规则</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/nocode/">动态模型</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/xui/">前端模型</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/integration/">第三方集成</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/spring/">spring集成</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/quarkus/">quarkus集成</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/idea/">IDEA插件</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/ide/plugin-dev/">插件开发</a>
      
      
    </li>
  
</ul>

      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/faq/">常见问题</a>
      
      
        <ul>
  
  
    
  
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/faq/debug-errors/">错误诊断</a>
      
      
    </li>
  
    <li>
      
      
      
      
      
        
        
        
        
          
          
        
        <a href="/projects/nop-entropy/docs/dev-guide/recipe/">常见问题解决方案</a>
      
      
    </li>
  
</ul>

      
    </li>
  
</ul>
</nav>
    </aside>
  
  <main class="Page-main">
    <article class="Article container-fluid">
      <header class="Article-header">
        
  
    <h1 class="Article-title">运行时监控</h1>
  
  


      </header>
      <div class="Article-content col-md-9"><p>Nop平台可以接入Prometheus和Grafana监控平台。下面以Windows平台为例，介绍如何在本机搭建一个简单的监控系统。</p>
<h2 id="常用端口"><a href="#常用端口" class="headerlink" title="常用端口"></a>常用端口</h2><ul>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a>  grafana，用户名nop,密码test</li>
<li><a target="_blank" rel="noopener" href="http://localhost:3100/ready">http://localhost:3100/ready</a>  loki</li>
<li><a target="_blank" rel="noopener" href="http://localhost:9090/targets">http://localhost:9090/targets</a>  prometheus</li>
</ul>
<h2 id="下载监控软件"><a href="#下载监控软件" class="headerlink" title="下载监控软件"></a>下载监控软件</h2><ul>
<li><p>prometheus: kubernetes内置的监控平台，负责采集监控指标数据按时间序列存储</p>
<ul>
<li>官网下载: <a target="_blank" rel="noopener" href="https://prometheus.io/download/">https://prometheus.io/download/</a></li>
<li>最新版本: <a target="_blank" rel="noopener" href="https://github.com/prometheus/prometheus/releases/download/v2.44.0/prometheus-2.44.0.windows-amd64.zip">https://github.com/prometheus/prometheus/releases/download/v2.44.0/prometheus-2.44.0.windows-amd64.zip</a></li>
</ul>
</li>
<li><p>windows_exporter: 监控windows操作系统，向prometheus报送数据的监控进程</p>
<ul>
<li>github下载： <a target="_blank" rel="noopener" href="https://github.com/prometheus-community/windows/_exporter/releases">https://github.com/prometheus-community/windows\_exporter/releases</a></li>
<li>最新版本: <a target="_blank" rel="noopener" href="https://github.com/prometheus-community/windows/_exporter/releases/download/v0.22.0/windows/_exporter-0.22.0-amd64.msi">https://github.com/prometheus-community/windows\_exporter/releases/download/v0.22.0/windows\_exporter-0.22.0-amd64.msi</a></li>
</ul>
</li>
<li><p>grafana: 可视化展示和分析平台</p>
<ul>
<li>官网下载: <a target="_blank" rel="noopener" href="https://grafana.com/grafana/download?platform=windows">https://grafana.com/grafana/download?platform=windows</a></li>
<li>最新版本：<a target="_blank" rel="noopener" href="https://dl.grafana.com/oss/release/grafana-10.0.1.windows-amd64.zip">https://dl.grafana.com/oss/release/grafana-10.0.1.windows-amd64.zip</a></li>
</ul>
</li>
<li><p>loki: 轻量级的日志存储和查询处理系统，可以替代ElasticSearch的作用</p>
<ul>
<li>github下载: <a target="_blank" rel="noopener" href="https://github.com/grafana/loki/releases">https://github.com/grafana/loki/releases</a></li>
<li>最新版本： <a target="_blank" rel="noopener" href="https://github.com/grafana/loki/releases/download/v2.8.2/loki-windows-amd64.exe.zip">https://github.com/grafana/loki/releases/download/v2.8.2/loki-windows-amd64.exe.zip</a></li>
</ul>
</li>
<li><p>promtail: 与loki协同工作的日志采集代理，它负责收集日志并转发到loki进行存储。</p>
<ul>
<li>github下载：  <a target="_blank" rel="noopener" href="https://github.com/grafana/loki/releases">https://github.com/grafana/loki/releases</a></li>
<li>最新版本：<a target="_blank" rel="noopener" href="https://github.com/grafana/loki/releases/download/v2.8.2/promtail-windows-amd64.exe.zip">https://github.com/grafana/loki/releases/download/v2.8.2/promtail-windows-amd64.exe.zip</a></li>
</ul>
</li>
</ul>
<h2 id="安装和配置软件"><a href="#安装和配置软件" class="headerlink" title="安装和配置软件"></a>安装和配置软件</h2><h3 id="安装windows-exporter"><a href="#安装windows-exporter" class="headerlink" title="安装windows_exporter"></a>安装windows_exporter</h3><p>直接安装msi文件之后，可以通过<a target="_blank" rel="noopener" href="http://localhost:9182/metrics%E6%9F%A5%E7%9C%8B%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E7%9A%84%E6%8C%87%E6%A0%87">http://localhost:9182/metrics查看对外暴露的指标</a></p>
<h3 id="安装prometheus"><a href="#安装prometheus" class="headerlink" title="安装prometheus"></a>安装prometheus</h3><p>在prometheus.yml配置文件中增加如下配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">windows_exporter</span><br>  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span><br>  <span class="hljs-attr">static_configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [ <span class="hljs-string">&quot;localhost:9182&quot;</span> ]<br></code></pre></td></tr></table></figure>

<p>使用如下命令启动prometheus</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">prometheus --config.file=&quot;prometheus.yml&quot; --web.enable-lifecycle<br></code></pre></td></tr></table></figure>

<ul>
<li><p>web.enable-lifecycle表示启用热加载机制，可以通过 <a target="_blank" rel="noopener" href="http://localhost:9090/-/reload%E6%9D%A5%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">http://localhost:9090/-/reload来重新加载配置文件</a></p>
</li>
<li><p>访问 <a target="_blank" rel="noopener" href="http://localhost:9090/targets">http://localhost:9090/targets</a> 可以查看所有监控端点</p>
</li>
</ul>
<h3 id="安装loki服务器"><a href="#安装loki服务器" class="headerlink" title="安装loki服务器"></a>安装loki服务器</h3><p><a target="_blank" rel="noopener" href="https://grafana.com/docs/loki/latest/api/">API文档</a></p>
<ul>
<li>GET &#x2F;config 读取所有配置项</li>
<li>GET &#x2F;ready 检查当前状态</li>
</ul>
<p>增加loki-config.yaml配置文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">auth_enabled:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">http_listen_port:</span> <span class="hljs-number">3100</span><br><br><span class="hljs-attr">ingester:</span><br>  <span class="hljs-attr">lifecycler:</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>    <span class="hljs-attr">ring:</span><br>      <span class="hljs-attr">kvstore:</span><br>        <span class="hljs-attr">store:</span> <span class="hljs-string">inmemory</span><br>      <span class="hljs-attr">replication_factor:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">final_sleep:</span> <span class="hljs-string">0s</span><br>  <span class="hljs-attr">chunk_idle_period:</span> <span class="hljs-string">5m</span><br>  <span class="hljs-attr">chunk_retain_period:</span> <span class="hljs-string">30s</span><br>  <span class="hljs-attr">max_transfer_retries:</span> <span class="hljs-number">0</span><br><br><span class="hljs-attr">schema_config:</span><br>  <span class="hljs-attr">configs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">from:</span> <span class="hljs-number">2023-06-22</span><br>      <span class="hljs-attr">store:</span> <span class="hljs-string">boltdb</span><br>      <span class="hljs-attr">object_store:</span> <span class="hljs-string">filesystem</span><br>      <span class="hljs-attr">schema:</span> <span class="hljs-string">v11</span><br>      <span class="hljs-attr">index:</span><br>        <span class="hljs-attr">prefix:</span> <span class="hljs-string">index_</span><br>        <span class="hljs-attr">period:</span> <span class="hljs-string">168h</span><br><br><span class="hljs-attr">storage_config:</span><br>  <span class="hljs-attr">boltdb:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">./data/loki/index</span><br><br>  <span class="hljs-attr">filesystem:</span><br>    <span class="hljs-attr">directory:</span> <span class="hljs-string">./data/loki/chunks</span><br><br><span class="hljs-attr">limits_config:</span><br>  <span class="hljs-attr">enforce_metric_name:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">reject_old_samples:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">reject_old_samples_max_age:</span> <span class="hljs-string">168h</span><br><br><span class="hljs-attr">chunk_store_config:</span><br>  <span class="hljs-attr">max_look_back_period:</span> <span class="hljs-string">0s</span><br><br><span class="hljs-attr">table_manager:</span><br>  <span class="hljs-attr">retention_deletes_enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">retention_period:</span> <span class="hljs-string">0s</span><br></code></pre></td></tr></table></figure>

<p>通过shell启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">loki-windows-amd64.exe --config.file=&quot;loki-config.yaml&quot;<br></code></pre></td></tr></table></figure>

<ul>
<li>访问 <a target="_blank" rel="noopener" href="http://localhost:3100/ready">http://localhost:3100/ready</a> ，成功启动后返回ready</li>
</ul>
<h2 id="安装promtail"><a href="#安装promtail" class="headerlink" title="安装promtail"></a>安装promtail</h2><p><a target="_blank" rel="noopener" href="https://blog.frognew.com/2023/05/loki-04-promtail-intro-and-config-ref.html">配置参考</a></p>
<p>增加promtail-config.yaml配置文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">http_listen_port:</span> <span class="hljs-number">9080</span><br>  <span class="hljs-attr">grpc_listen_port:</span> <span class="hljs-number">0</span><br><br><span class="hljs-attr">positions:</span><br>  <span class="hljs-attr">filename:</span> <span class="hljs-string">./data/positions.yaml</span><br><br><span class="hljs-attr">clients:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">http://localhost:3100/loki/api/v1/push</span><br><br><span class="hljs-attr">scrape_configs:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">demo</span><br>  <span class="hljs-attr">static_configs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">labels:</span><br>      <span class="hljs-attr">job:</span> <span class="hljs-string">demologs</span><br>      <span class="hljs-attr">__path__:</span> <span class="hljs-string">C:\can\nop\nop-entropy\log\*.log</span><br><br></code></pre></td></tr></table></figure>

<p>通过命令行启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">promtail-windows-amd64.exe -config.file=&quot;promtail-config.yaml&quot;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>通过如下指令获取调试诊断信息<br>curl localhost:3100&#x2F;debug&#x2F;pprof&#x2F;profile?seconds&#x3D;20</p>
</blockquote>
<h3 id="安装grafana"><a href="#安装grafana" class="headerlink" title="安装grafana"></a>安装grafana</h3><p>将grafana的conf目录下的sample.ini文件复制为custom.ini，然后修改其中的登录用户名和密码，缺省为admin&#x2F;admin。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">[security]<br><br>admin_user = nop<br><br><br>admin_password = test<br></code></pre></td></tr></table></figure>

<p>在grafana&#x2F;bin目录下通过如下指令启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">grafana-server --config=&quot;../conf/custom.ini&quot;<br></code></pre></td></tr></table></figure>

<ul>
<li>访问<a href="http://localhost:3000，通过用户名">http://localhost:3000，通过用户名</a> nop，密码test登录</li>
</ul>
<blockquote>
<p>首次启动后初始化用户名和密码就保存到了grafana&#x2F;data目录下，修改ini文件中的admin_user等配置不再起作用。</p>
</blockquote>
<h4 id="在-Grafana-中添加-Loki-数据源"><a href="#在-Grafana-中添加-Loki-数据源" class="headerlink" title="在 Grafana 中添加 Loki 数据源"></a>在 Grafana 中添加 Loki 数据源</h4><p>在使用 Grafana 进行可视化管理之前，您需要将 Loki 数据源添加到 Grafana。请按照以下步骤操作：</p>
<ul>
<li>打开 Grafana UI，登录并单击“配置”按钮（位于左侧菜单中）。</li>
<li>在“数据源”下单击“添加数据源”。</li>
<li>选择“Loki”作为数据源类型。</li>
<li>输入 Loki API 地址及其相关详细信息。在本例中，Loki API 的地址为 <a href="http://localhost:3100。">http://localhost:3100。</a></li>
<li>单击“保存并测试”以测试数据源是否正常工作。</li>
</ul>
<h4 id="创建-Grafana-Dashboard"><a href="#创建-Grafana-Dashboard" class="headerlink" title="创建 Grafana Dashboard"></a>创建 Grafana Dashboard</h4><ul>
<li>打开 Grafana UI 并单击“+”按钮（左侧菜单中）。</li>
<li>单击“Dashboard”选项。</li>
<li>单击“Add new panel”以添加一个新的 Panel。</li>
<li>选择您要显示的指标（例如，请选择“Logs”指标以显示来自 Loki 的日志数据）。</li>
<li>根据需要调整其他设置，并保存 Dashboard。</li>
</ul>
<h2 id="使用docker-compose安装"><a href="#使用docker-compose安装" class="headerlink" title="使用docker-compose安装"></a>使用docker-compose安装</h2><p>除了手动安装之外，也可以通过docker-compose自动安装grafana, loki和promtail</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">wget https://raw.githubusercontent.com/grafana/loki/v2.8.0/production/docker-compose.yaml -O docker-compose.yaml<br>docker-compose -f docker-compose.yaml up<br></code></pre></td></tr></table></figure>

<h2 id="问题诊断"><a href="#问题诊断" class="headerlink" title="问题诊断"></a>问题诊断</h2><ul>
<li><p>Loki: 启动时提示 panic: invalid page type: 11:10<br>原因: 对应的 index table 文件已经损坏<br>解决: 删除相应的 index 文件即可解决</p>
</li>
<li><p>Loki: file size too small\nerror creating index client<br>解决: 删除 loki 的持久化目录下的 boltdb-shipper-active&#x2F;index_18xxx 目录</p>
</li>
<li><p>promtail: context deadline exceeded<br>原因: promtail 无法连接 loki 所致</p>
</li>
</ul>

</div>
      <footer class="Article-footer col-md-3">
        
          
          
          
          
            
          
          
            <div class="Widget">
              <div class="Widget-body"><a href="https://gitee.com/canonical-entropy/nop-entropy/edit/master/docs/user-guide/monitor/grafana.md" target="_blank" rel=" rel="external nofollow"">在 Gitee 上编辑文档内容</a></div>
            </div>
          
        
        
  

  <section class="Widget Widget--toc">
  <div class="Widget-header">
    <h2 class="Widget-title">目录</h2>
  </div>
  <div class="Widget-body"></div>
</section>



      </footer>
    </article>
    <footer class="Page-footer Footer">
  <div class="container-fluid">
    
    <div class="Footer-description">
      
        <!-- Important links -->
        <nav class="Footer-navs">
          <ul><li><a href="/projects/nop-entropy/docs"><span>指南</span></a>
</li><li><a href="/community"><span>社区</span></a>
</li></ul>
        </nav>
      
      
        <!-- Copyright -->
        <div class="Footer-copyright">
          <p>

&copy; 2024 <a href="https://nop-platform.gitee.io?utm_source=https://nop-platform.gitee.io&amp;utm_medium=common-footer" target="_blank" rel="external nofollow">Nop 社区</a> 版权所有

</p>
          
          
        </div>
      
    </div>
  </div>
</footer>

  </main>
</div>




    <script>$('.Article-content > table').addClass('table table-bordered')</script>
    
<script src="/javascripts/ksio/vendors/share.min.js"></script>

<script src="/javascripts/ksio/components/page.js"></script>

<script src="/javascripts/ksio/components/toc.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.js"></script>

<script src="/javascripts/ksio/vendors/jquery.timeago.zh-CN.js"></script>

<script src="/javascripts/ksio/initializers/time.js"></script>

<script src="/javascripts/ksio/vendors/jquery.lazyload.js"></script>

<script src="/javascripts/ksio/initializers/lazyload.js"></script>

  </body>
</html>

